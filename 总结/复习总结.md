## å¤ä¹ æ€»ç»“
### ä¸€ã€js

#### 1. Es6è¯­æ³•çŸ¥é“é‚£äº›ï¼Ÿæ€ä¹ˆç”¨çš„ï¼Ÿ

+ **let**ï¼šå—çº§å˜é‡å£°æ˜ï¼Œåªåœ¨letå‘½ä»¤æ‰€åœ¨çš„ä»£ç å—ï¼ˆå—çº§ä½œç”¨åŸŸï¼‰æœ‰æ•ˆ------æš‚æ—¶æ€§æ­»åŒºï¼ˆåªè¦å˜é‡åœ¨letå£°æ˜å‰ä½¿ç”¨ï¼Œå°±ä¼šæŠ¥é”™ï¼‰
+ **const**ï¼šå—çº§å¸¸é‡å£°æ˜
+ **ç®­å¤´å‡½æ•°**ï¼š sum = (a, b) => a + b; nums.forEach(item => console.log(item)) 
+ **è§£æ„èµ‹å€¼**ï¼šæ•°ç»„è§£æ„ã€å¯¹è±¡è§£æ„
+ **æ‰©å±•è¿ç®—ç¬¦**ï¼š {...xxx} ç”¨äºå–å‡ºå¯¹è±¡ä¸­çš„æ‰€æœ‰å¯éå†è‹é†’ï¼Œæ‹·è´åˆ°å½“å‰å¯¹è±¡ä¸­ï¼›
+ **import(å¯¼å…¥)**ã€**export(å¯¼å‡º)**ã€**export defalut(é»˜è®¤å¯¼å‡º)**ï¼›
+ **Object.assign()** å¯¹è±¡åˆå¹¶ï¼Œå°†æºå¯¹è±¡çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œå¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡
+ **Symbol**ï¼šåŸºæœ¬æ•°æ®ç±»å‹
+ **Setå»é‡**
+ **promiseå¯¹è±¡**ï¼š å¼‚æ­¥å¯¹è±¡ï¼ˆå¯ä»¥ä»å®ƒé‚£é‡Œè·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ï¼‰ä¸‰ç§çŠ¶æ€ï¼špedding(è¿›è¡Œä¸­)ã€fulfilled(å·²æˆåŠŸ)ã€rejected(å·²å¤±è´¥)
+ **proxy**ï¼š ä»£ç†å™¨
+ **async\await**ï¼šä»¥ç®€æ´çš„æ–¹å¼ç¼–å†™åŸºäºpromiseçš„å¼‚æ­¥è¡Œä¸ºï¼Œé¿å…é“¾å¼è°ƒç”¨promise
  ç‰¹æ€§åˆ—è¡¨æ•´ç†ï¼ˆhttps://fangyinghang.com/es-6-tutorials/ï¼‰

#### 2. Promiseã€Promise.allã€Promise.raceåˆ†åˆ«æ€ä¹ˆç”¨ï¼Ÿ

+ **promiseçš„ç”¨æ³•**ï¼ˆæ­»è®°ï¼‰

  ```js
  function fn() {
      return new Promise(resolve, reject) {
     		// æˆåŠŸæ—¶æ‰§è¡Œresolve()
          // å¤±è´¥æ—¶æ‰§è¡Œreject()
      }
  }
  ```

+ **promise.all**çš„ç”¨æ³•ï¼ˆæ­»è®°ï¼‰

  ```js
  promise.all([promise1, promise2]).then(success, fail);
  // promise1ä¸promise2éƒ½æˆåŠŸåæ‰ä¼šæ‰§è¡Œsuccess
  ```

+ **promise.race**çš„ç”¨æ³•ï¼ˆæ­»è®°ï¼‰

  ```js
  promise.race([promise1, promise2]).then(success, fail);
  // promise1ä¸promise2åªè¦æœ‰ä¸€ä¸ªæˆåŠŸå°±ä¼šè°ƒç”¨æˆåŠŸ
  // promise1ä¸promise2åªè¦æœ‰ä¸€ä¸ªå¤±è´¥å°±ä¼šè°ƒç”¨å¤±è´¥
  // æ€»ä¹‹ï¼Œè°ç¬¬ä¸€ä¸ªå…ˆæˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå°±è®¤ä¸ºæ˜¯raceçš„çŠ¶æ€æ˜¯æˆåŠŸæˆ–è€…å¤±è´¥
  ```

#### 3. æ‰‹å†™é˜²æŠ–å‡½æ•°ä¸èŠ‚æµå‡½æ•°

> é˜²æŠ–ï¼šä¸€æ®µæ—¶é—´å†…ç­‰å¾…ï¼Œæ‰€æœ‰çš„ä¸€èµ·æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼šå¤–å–å‘˜ç­‰å¾…æ‹¿å¤–å–ï¼‰

```js
function debound(fn, time) {
    let timeId = null;
    return function() {
    	let const = this;
        if(timeId) windown.clearTimeout(timeId)
        timeId = setTimeout(() => {
            fn.apply(const, arguments)
            timeId = null
        }, time)
    }
}
```

> èŠ‚æµï¼šç›¸åŒæ—¶é—´å†…æ‰§è¡Œä¸€æ¬¡åï¼Œç¬¬äºŒæ¬¡ä¸ä¼šæ‰§è¡Œ

```js
function throttly(fn, time) {
    let canUse = true;
    return function() {
        if(canUse) {
        	fn.apply(this, arguments);
            canUse = false;
            setTimeout(() => {
                canUse = true
            }, time)
        }
    }
}
```

#### 4. **æ‰‹å†™AJAX**(èƒŒä»£ç )

        1. å®Œæ•´ç‰ˆ
    
           ```js
           // åˆ¤æ–­å…¼å®¹æ€§
           var request = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject();
           request.open('GET', '/a/b?name=1254', true);
           request.onreadystatechange = function() {
               if(request.readstate === 4 && request.status === 200) {
                   console.log(requset.responseText)
               }
           }
           request.send()
           ```

2. ç®€æ˜“ç‰ˆ

   ```js
   // åˆ¤æ–­å…¼å®¹æ€§
   var request = window.XMLHttpRequest ? new XMHttpRequest() : new ActiveXObject();
   request.open('GET', '/a/b?name=5656', true);
   request.load = function() {
       console.log(request.responseText)
   }
   request.send()
   ```

#### 5. ä»¥ä¸‹ä»£ç thisæŒ‡å‘æ˜¯ä»€ä¹ˆï¼Ÿ

 1. èƒŒä»£ç 

    **fn()**: thisæŒ‡å‘ **Windows/global**

    **obj.fn()**: thisæŒ‡å‘ **obj**
    **fn.call(xx)**: thisæŒ‡å‘**xxx ä¼ å…¥å¯¹è±¡**
    **fn.apply(xx)**: thisæŒ‡å‘**xx ä¼ å…¥å¯¹è±¡**
    **fn.bind(xx)**: thisæŒ‡å‘**xx ä¼ å…¥å¯¹è±¡**
    **new Fn()**: thisæŒ‡å‘**å®ä¾‹å¯¹è±¡**
    **fn = () =>{}**: thisæŒ‡å‘å¤–é¢çš„this

    > çœ‹è°ƒç”¨ [ã€Šthis çš„å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ¬¡è¯´æ¸…æ¥šã€‹](https://zhuanlan.zhihu.com/p/23804247)

#### 6. é—­åŒ…å’Œç«‹å³æ‰§è¡Œå‡½æ•°åˆ†åˆ«æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ

1. **é—­åŒ…**: 

    > å›ç­”æ¨¡å¼ï¼š 1. ä»€ä¹ˆæ˜¯[é—­åŒ…];  2. ã€é—­åŒ…ã€‘çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

    **é—­åŒ…æ˜¯ä»€ä¹ˆ**ï¼šã€å‡½æ•°ã€‘å’Œã€å‡½æ•°å†…éƒ¨èƒ½è®¿é—®åˆ°çš„å˜é‡ã€‘ï¼ˆç¯å¢ƒï¼‰çš„æ€»å’Œï¼Œå°±æ˜¯ä¸€ä¸ªé—­åŒ…
    **é—­åŒ…çš„ä½œç”¨**ï¼šã€é—´æ¥è®¿é—®ä¸€ä¸ªå˜é‡ã€‘

2. **ç«‹å³æ‰§è¡Œå‡½æ•°**

    > å›ç­”æ¨¡å¼ï¼š 1. ä»€ä¹ˆæ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°ï¼› 2. ç«‹å³æ‰§è¡Œå‡½æ•°æœ‰ä»€ä¹ˆç”¨é€”

    **ç«‹å³æ‰§è¡Œå‡½æ•°**å°±æ˜¯ã€å£°æ˜ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œç„¶åç«‹é©¬è°ƒç”¨è¿™ä¸ªåŒ¿åå‡½æ•°ã€‘
    eg: `(function() {alert('æˆ‘æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°')})()`

    **ç«‹å³æ‰§è¡Œå‡½æ•°çš„ä½œç”¨**ï¼šã€åˆ›é€ ä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œè¿™ä¸ªä½œç”¨åŸŸé‡Œé¢çš„å˜é‡ï¼Œå¤–é¢è®¿é—®ä¸åˆ°ï¼ˆå³é¿å…ã€Œå˜é‡æ±¡æŸ“ã€ï¼‰ã€‘

#### 7. ä»€ä¹ˆæ˜¯JSONP? ä»€ä¹ˆæ˜¯CORS? ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ

> åŒæºç­–ç•¥ï¼šä»ä¸€ä¸ªæºçš„æ–‡æ¡£æˆ–è€…è„šæœ¬å¦‚ä½•ä¸å¦å¤–ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œè¿™æ˜¯ä¸€ä¸ªéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„å…³é”®å®‰å…¨æœºåˆ¶ï¼ˆ**æºï¼šåè®®ã€åŸŸåã€ç«¯å£ï¼Œè¿™ä¸‰è€…æœ‰ä¸€ä¸ªä¸åŒï¼Œåˆ™æºä¸åŒ**ï¼‰

* JSONP:
    + JSONPæ˜¯é€šè¿‡scriptæ ‡ç­¾åŠ è½½æ•°æ®çš„æ–¹å¼å»è·å–æ•°æ®å½“åšjsä»£ç æ¥æ‰§è¡Œ
    + æå‰åœ¨é¡µé¢ä¸­å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åé€šè¿‡æ¥å£ä¼ å‚çš„æ–¹å¼ä¼ ç»™åå°ï¼Œåå°è§£æåˆ°è¿™ä¸ªå‡½æ•°åååœ¨åŸå§‹æ•°æ®ä¸Šã€ŒåŒ…è£¹ã€è¿™ä¸ªå‡½æ•°åï¼Œå‘é€ç»™å‰ç«¯ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒJSONPéœ€è¦è·Ÿå¯¹åº”æ¥å£çš„åç«¯é…åˆæ‰èƒ½å®ç°ã€‚----åªèƒ½å‘èµ·getè¯·æ±‚
* CORSï¼šåœ¨å¿…é¡»è·¨åŸŸè®¿é—®èµ„æºçš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨æ€ä¹ˆæ²Ÿé€šï¼ˆä¸€èˆ¬åè®®ï¼‰
     + è·¨æºèµ„æºå…±äº«ï¼Œå®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘é€XMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœAJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚ï¼ˆéœ€è¦å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å…±åŒé…åˆè®¾ç½®ï¼‰----æ”¯æŒæ‰€æœ‰ç±»å‹httpè¯·æ±‚
     + ç®€å•è¯·æ±‚: (1. è¯·æ±‚æ–¹æ³•æ˜¯HEADã€GETã€POSTä¸‰ç§æ–¹æ³•çš„ä»»æ„ä¸€ç§ï¼› 2. HTTPçš„å¤´ä¿¡æ¯ä¸èƒ½è¶…è¿‡ï¼šAcceptã€Accept-Languageã€Content-Languageã€Last-Event-IDã€Content-Typeï¼šapplication/x-www.from-urlencodedã€multipart/form-dataã€text/plain )
     + å¤æ‚è¯·æ±‚ï¼š(1. è¯·æ±‚æ–¹æ³•æ˜¯ï¼šPUTã€DELETE; 2. Content-Type: application/json)
* è·¨åŸŸï¼šåœ¨æµè§ˆå™¨åŒæºç­–ç•¥çš„æƒ…å†µä¸‹ï¼Œå‘ä¸åŒçš„æºå‘é€XHRè¯·æ±‚ï¼Œæµè§ˆå™¨è®¤ä¸ºè¯¥è¯·æ±‚ä¸å—ä¿¡ä»»ï¼Œç¦æ­¢è¯·æ±‚

#### 8. aysnc/awaitæ€ä¹ˆç”¨ï¼Œå¦‚ä½•æ•è·å¼‚å¸¸ï¼Ÿ

**aysnc/await**

`aysnc`è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¹³promiseå¯¹è±¡ï¼Œä¸€æ—¦é‡åˆ°awaitå°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥

`await`å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼

```js
// async
// å‡½æ•°å£°æ˜
async function foo(){}
// å‡½æ•°è¡¨è¾¾å¼
const foo = async function() {}
// å¯¹è±¡çš„æ–¹æ³•
let obj = { async foo() {} };
obj.foo().then(....);
// classæ–¹æ³•
class Storage() {
    constructor() {
        super();
        this.cachePromise = caches.open('avators')
    }
    async getArray(name) {
        const cache = await this.cachePromise;
        return cache.match(`/avatars/${name}.jpg`);
    }
}
const storage = new Storage();
storage.getArray('kate').then(...)
// ç®­å¤´å‡½æ•°
const foo = async () =>{}
```

æ•è·å¼‚å¸¸ï¼šasyncå‡½æ•°å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œä¼šå¯¼è‡´è¿”å›çš„promiseå¯¹è±¡å˜æˆrejectçŠ¶æ€ã€‚æŠ›å‡ºçš„é”™è¯¯å¯¹è±¡ä¼šè¢«catchæ–¹æ³•å›è°ƒæ¥æ”¶ã€‚é™¤äº†ä½¿ç”¨.catchæ¥é”™è¯¯å¼‚å¸¸ï¼Œè¿˜å¯ä»¥ä½¿ç”¨try/catchæ¥æ•è·å¼‚å¸¸

```js
async handleSubmit() {
    await Promise.all([promise1, promise2]).then(r=>{
        console.log(r)
    }).catch(err => {
        console.log(err)
    })
}
async handleSubmi() {
    try{
        await Promise.all([promise1, promise2]);
        return true
    } catch(err) {
        console.log(err)
        return false
    }
}
```

#### 9. å¦‚ä½•å®ç°æ·±æ‹·è´ï¼Ÿ

> æ·±æ‹·è´ï¼šå°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜æ€»å®Œæ•´çš„æ‹·è´å‡ºæ¥ï¼Œä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªåŒºåŸŸæ¥å­˜æ”¾æ–°å¯¹è±¡ï¼Œä¸”ä¿®æ”¹æ–°å¯¹è±¡ä¸ä¼šå½±å“åŸå¯¹è±¡

> èƒŒä»£ç ï¼Œè¦ç‚¹ï¼š
>
> 1. é€’å½’
> 2. åˆ¤æ–­ç±»å‹
> 3. æ£€æŸ¥ç¯ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰
> 4. éœ€è¦å¿½ç•¥åŸå‹

**1.  åŸºç¡€ç‰ˆæœ¬ï¼ˆä¸åŒ…æ‹¬æ•°ç»„å’ŒåµŒå¥—ï¼‰**

```js
function clone(target) {
    let cloneTarget = {};
    for(const key in target) {
        cloneTarget[key] = target[key]
    }
    return cloneTarget
}
```

**2. å‡çº§ç‰ˆæœ¬**

> weakMapå¯¹è±¡æ˜¯ä¸€ç»„é”®/å€¼å¯¹çš„é›†åˆï¼Œå…¶ä¸­çš„é”®æ˜¯å¼±å¼•ç”¨ã€‚æœŸé”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„
>
> **weakMapçš„ä½œç”¨ï¼š**å¦‚æœè¦æ‹·è´çš„å¯¹è±¡éå¸¸åºå¤§æ—¶ï¼Œä½¿ç”¨Mapä¼šå¯¹å†…å­˜é€ æˆéå¸¸å¤§çš„é¢å¤–æ¶ˆè€—ï¼Œè€Œä¸”æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¸…é™¤Mapçš„å±æ€§æ‰èƒ½é‡Šæ”¾è¿™å—å†…å­˜ï¼Œè€ŒweakMapå¯ä»¥å¸®æˆ‘ä»¬åŒ–è§£è¿™ä¸ªé—®é¢˜
>
> **å¼ºå¼•ç”¨**ï¼š

```js
function forEachKey(arr, iteratee){
    let index = -1;
    const length = arr.length;
    while(++index < length) {
        iteratee(array[index], index)
    }
    return array
}
function clone(target, map = new weakMap()) {
	// åˆ¤æ–­ç±»å‹
    if(typeof target === 'object') {
        const isArray = Array.isArray(target);
        let cloneTarget = isArray ? [] : {};
        // é˜²æ­¢å¾ªç¯å¼•ç”¨
        if(map.get(target)){
            return map.get(target)
        }
        map.set(target, cloneTarget);
        // å…‹éš†å¯¹è±¡å’Œæ•°ç»„
        const keys = isArray ? undefined : Object.keys(target);
        forEachKey(keys || target, (value, key) => {
            if(keys) {
                key =value
            }
            cloneTarget[key] = clone(target[key], map)
        })
        return cloneTarget
    } else {
    	return target
    }
}
```

#### 10. å¦‚ä½•æ­£åˆ™å®ç°trim()? å»é™¤ç©ºæ ¼(èƒŒä»£ç )

```
String.prototype.trim = function() {
	return this.replace(/^\s+$/g, '')
}
// æ–¹å¼2
function trim(string) {
	return string.replace(/^\s+$/g, '')
}
```

#### 11. ä¸ä½¿ç”¨classå¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿç”¨classåˆå¦‚ä½•å®ç°ï¼Ÿï¼ˆèƒŒä»£ç ï¼‰

```js
// ä½¿ç”¨callå’ŒåŸå‹é“¾
function Person(name, year) {
    this.name = name;
    this.year = year;
}
function Child(color) {
    Person.call(this)
    this.color = color
}
Child.prototype = Object.create(Person.prototype)
Child.prototype.constructor = Child

```

```
// ä½¿ç”¨classå®ç°ç»§æ‰¿
class Person {
	constructor(color) {
		this.color = color
	}
}
class Child extends Person{
	constructor(coloe, name) {
		super(color)
		this.name = name
	}
}
```

#### 12. æ•°ç»„å»é‡

> 1. è®¡æ•°æ’åºå˜å½¢ï¼ŒèƒŒä»£ç 
> 2. ä½¿ç”¨ Setï¼ˆé¢è¯•å·²ç»ç¦æ­¢è¿™ç§äº†ï¼Œå› ä¸ºå¤ªç®€å•ï¼‰
> 3. ä½¿ç”¨ WeakMap

#### 13. æ‰‹å†™ä¸€ä¸ª Promise

å‚è€ƒ https://juejin.im/post/5aafe3edf265da238f125c0a

### äºŒã€DOMç›¸å…³

#### 1. DOMäº‹ä»¶ç±»ï¼šDOMäº‹ä»¶çº§åˆ«

> 1. DOM1.0 ï¼šelement.onclick = function() {}
> 2. DOM2.0ï¼šelement.addEventLister('click', function() {}, false)
> 3. DOM3.0ï¼šelement.addEventLister('keyup', function() {}, false) // æ–°å¢é”®ç›˜äº‹ä»¶

#### 2. DOMäº‹ä»¶æ¨¡å‹ï¼šå†’æ³¡ä¸æ•è·

> æ•è·ï¼šä»ä¸Šè€Œä¸‹ï¼š å¼€å§‹ä¸ºwindow
>
> æ•è·ï¼šä»ç›®æ ‡å…ƒç´ å¼€å§‹å¾€ä¸Šé¢æ‰¾

**DOMäº‹ä»¶æµ**ï¼š

#### 1. äº‹ä»¶å§”æ‰˜

```

```



### typescript

	1.neverç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ ä¸åº”è¯¥å‡ºç°çš„ç±»å‹


â€‹	
â€‹	

è¯´æ˜æ–‡æ¡£

1ã€æè¿°ï¼šæœ¬é¡¹ç›®é«˜æ•ˆä¾¿æ·åœ°å®ç°ç¤¾åŒºçš„äººã€è´¢ã€ç‰©çš„ç®¡ç†ï¼Œæ¶µç›–ç¤¾åŒºæœåŠ¡ã€ç¤¾å•†ç»è¥ã€å¹³å°è¿è¥å’Œä¼ä¸šç®¡ç†å››å¤§æ¨¡å—ã€‚æµç¨‹åŒ–ç®¡ç†ä¸ä¸ªæ€§åŒ–è¿è¥ç›¸ç»“åˆï¼Œå¯å»ºç«‹ç‰©ä¸šæœåŠ¡æ ‡å‡†ã€æµç¨‹æ ‡å‡†ã€ç®¡å®¶æœåŠ¡ä½“ç³»ç­‰æ ‡å‡†åŒ–ç®¡ç†æµç¨‹ï¼Œä¹Ÿå¯é’ˆå¯¹å„ç¤¾åŒºåšä¸ªæ€§åŒ–é…ç½®ã€‚å®æ—¶æŒæ¡ç¤¾åŒºç”¨æˆ·åŠç¤¾åŒºæœåŠ¡äººå‘˜åŠ¨æ€ï¼Œå¿«é€Ÿå“åº”ç”¨æˆ·çš„æœåŠ¡è¯·æ±‚ï¼Œæ™ºèƒ½è°ƒåº¦ç¤¾åŒºæœåŠ¡äººå‘˜ï¼Œä¸ºç¤¾åŒºç”¨æˆ·æä¾›é«˜å“è´¨çš„ç‰©ä¸šæœåŠ¡

ä¸»è¦è´Ÿè´£ï¼š1. è´Ÿè´£å„ç‰ˆæœ¬éœ€æ±‚è¿­ä»£ï¼Œé«˜è´¨é‡é«˜ä¿çœŸè¾“å‡ºUIä¸éœ€æ±‚ï¼›

2ã€æè¿°ï¼š

### ä¸‰. æ„å»ºå·¥å…·

#### Gulpæ˜¯webå¼€å‘ä¸­å¸®åŠ©ä½ è‡ªåŠ¨å®Œæˆä»»åŠ¡çš„å·¥å…·ï¼ŒåŸºäºNodejs Stream æµçš„æ‰¹é‡å¤„ç†å·¥å…·

> Gulpçš„æ ¸å¿ƒï¼š
>
> 1. å¦‚ä½•åˆ¶å®šä¸€å¥—åˆç†ã€å¯é…ç½®ã€èƒ½å¤ŸçœŸæ­£æå‡æˆ‘ä»¬å·¥ä½œæ•ˆç‡çš„æ„å»ºæµç¨‹
> 2. å¦‚ä½•åœ¨éœ€è¦æŸä¸ªåŠŸèƒ½æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°æœ€åˆé€‚çš„é‚£ä¸ªæ’ä»¶ï¼Œä¸”èƒ½å¤Ÿå¿«é€Ÿä½¿ç”¨
>
> Gulpçš„ç‰¹ç‚¹ï¼š
>
> + ä¸‡äº‹çš†ä»»åŠ¡
> + åŸºäºNodeJsæ•°æ®æµ

+ å¯åŠ¨Web Server
+ å½“æ–‡ä»¶ä¿®æ”¹ä¿å­˜åï¼Œè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨
+ æ‰¹é‡å¤„ç†Sassæˆ–è€…Lessæ–‡ä»¶
+ babelè½¬ES11é«˜çº§ç‰ˆæœ¬åˆ°Es5
+ ä¼˜åŒ–èµ„æºCssã€Javascriptã€Images

#### ä½¿ç”¨æ–¹å¼

1. å…¨å±€å®‰è£…gulp-cli: `npm i -g gulp-cli`

2. å±€éƒ¨å®‰è£…ï¼š`npm i glup --save-dev`

3. åˆ›å»ºé»˜è®¤ä»»åŠ¡`gulpfile.js`

4. åˆ›å»ºcopyä»»åŠ¡

   > gulpæš´éœ²äº†src()å’Œdest()æ–¹æ³•ç”¨äºå¤„ç†è®¡ç®—æœºä¸Šå­˜æ”¾çš„æ–‡ä»¶
   >
   > + src()è¿›è¡Œæ–‡ä»¶è¯»å…¥ï¼š é€‰æ‹©éœ€è¦çš„æ–‡ä»¶ï¼Œè¯»å–å†…å­˜ç§å¹¶é€šè¿‡æµè¿›è¡Œå¤„ç†
   > + dest()è¿›è¡Œè¾“å‡ºæ–‡ä»¶ï¼šå°†æ–‡ä»¶å­˜åœ¨ç³»ç»Ÿç›®å½•å†…

5. 

   ```
   // 
   
   ```

### æ¡†æ¶å†…ï¼šVueã€React(æ ¸å¿ƒ)

#### Vue

##### 1.1 æ•°æ®åŒå‘ç»‘å®šåŸç†ï¼ˆæ•°æ®é©±åŠ¨è§†å›¾ï¼‰

>  **UI = render(state)**: çŠ¶æ€stateæ˜¯è¾“å…¥ï¼Œé¡µé¢UIæ˜¯è¾“å‡ºï¼ŒçŠ¶æ€è¾“å…¥ä¸€æ—¦å˜äº†ï¼Œé¡µé¢è¾“å‡ºä¹Ÿéšä¹‹è€Œæ”¹å˜ï¼Œè¿™ç§ç‰¹æ€§å°±æ˜¯æ•°æ®é©±åŠ¨è¯•å›¾

+ å˜åŒ–ä¾¦å¯Ÿï¼š è¿½è¸ªçŠ¶æ€ ã€‚

  **angular**ä¸­æ˜¯é€šè¿‡è„å€¼æ£€æµ‹æµç¨‹æ¥å®ç°å˜åŒ–ä¾¦å¯Ÿï¼›

  **react**ä¸­æ˜¯é€šè¿‡å¯¹æ¯”è™šæ‹ŸDomæ¥å®ç°å˜åŒ–ä¾¦æµ‹

  **vue**ä¸­æ˜¯ä½¿ç”¨`Object.defineProperty`æ¥æ£€æµ‹

  + `Object.defineProperty`æ£€æµ‹æ•°æ®æ›´æ–°ï¼ˆ**é’ˆå¯¹Objectçš„å˜åŒ–ä¾¦æµ‹**ï¼‰

    > vueæºç ä¸­å®šä¹‰äº†ä¸€ä¸ªObserverç±»ï¼Œå®ƒå°†ä¸€ä¸ªæ­£å¸¸çš„objectè½¬æ¢ä¸ºå¯æ£€æµ‹çš„object,å¹¶ä¸”ç»™valueæ–°å¢ä¸€ä¸ª__ob__å±æ€§ï¼Œå€¼ä¸ºvalueçš„Observerå®ä¾‹ã€‚è¿™ä¸ªæ“ä½œç›¸å½“äºä¸ºvalueæ‰“ä¸Šäº†æ ‡è®°ï¼Œè¡¨ç¤ºå®ƒå·²ç»è¢«è½¬åŒ–ä¸ºå“åº”å¼äº†ï¼Œå¯é¿å…é‡å¤æ“ä½œ.

    ```js
    // æºç ä½ç½®ï¼šsrc/core/observer/index.js
    /**
     * Observerç±»ä¼šé€šè¿‡é€’å½’çš„æ–¹å¼æŠŠä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½è½¬åŒ–æˆå¯è§‚æµ‹å¯¹è±¡
     */
     export class Observer {
     	constructor(value) {
     		this.value = value;
     		def(value, '__ob__', this)
     		if(Array.isArray(value)){
     			// å¤„ç†valueæ˜¯æ•°ç»„çš„é€»è¾‘
     		} else {
     			this.walk(value)
     		}
     	}
     	walk(obj: Object){
     		const keys = Object.keys(obj)
     		for(let key= 0; key < keys.length, key++) {
     			defineReactive(obj, keys[i])
     		}
     	}
     }
     defineReactive(obj, key, val) {
     	// å¦‚æœåªä¼ äº†objå’Œkey,é‚£ä¹ˆval = obj[key]
     	if(arguments.length === 2) {
     		val = obj[key]
     	}
     	if(typeof val === 'object') {
     		new Observer(val)
     	}
     	Object.defineProperty(obj, key, {
     		enumerable: true,
     		configurable: true,
     		get: function() {
     			return val
     		}, 
     		set: function(newVal) {
     			if(val === newVal) {
                     return
     			}
     			val = newVal
     		}
     	})
     }
    ```

  + ä¾èµ–æ”¶é›†ï¼šä½¿ç”¨è€…ä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ï¼ˆå³ä¾èµ–äº†è¿™ä¸ªæ•°æ®ï¼‰ï¼Œæ¯ä¸ªæ•°æ®éƒ½æœ‰ä¸€ä¸ªä¾èµ–æ•°ç»„ï¼Œè°ä¾èµ–äº†è¿™ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªæ•°æ®æ”¾åˆ°è¿™ä¸ªä¾èµ–æ•°ç»„ä¸­ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±å»å®ƒå¯¹åº”çš„ä¾èµ–æ•°ç»„ä¾æ¬¡é€šçŸ¥ã€‚**åœ¨getterä¸­æ”¶é›†ä¾èµ–ï¼Œåœ¨setterä¸­é€šçŸ¥ä¾èµ–æ›´æ–°**

  + ä¾èµ–æ”¶é›†åˆ°äº†å“ªé‡Œï¼Ÿ ç»™æ¯ä¸ªæ•°æ®å»ºç«‹ä¸€ä¸ª**ä¾èµ–ç®¡ç†å™¨**ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®çš„æ‰€æœ‰ä¾èµ–éƒ½ç®¡ç†èµ·æ¥

    ```js
    // æºç ä½ç½®ï¼šsrc/core/observe/dep.js
    exports default class Dep{
    	constructor() {
            this.subs = [] // å­˜æ”¾ä¾èµ–
        }
        // æ–°å¢
        addSub(sub) {
    		this.subs.push(sub)
        }
    	// åˆ é™¤ä¸€ä¸ªä¾èµ–
    	removeSub(sub) {
            remove(this.subs, sub)
        }
    	// æ·»åŠ ä¸€ä¸ªä¾èµ–
    	depend(sub) {
            if(window.target) {
                this.addSub(window.target)
            }
        }
    	// é€šçŸ¥æ‰€æœ‰ä¾èµ–
    	notify() {
            const subs = this.subs.slice()
            for(let i=0; l=subs.length, i< l, i++) {
                subs[i].update()
            }
        }
    }
    // åˆ é™¤å•ä¸ªé¡¹
    export function remove(arr, item) {
        if(arr.length) {
            const index = arr.indexOf(item)
            if(index > -1) {
                return arr.splice(index, 1)
            }
        }
    }
    ```

    æœ‰äº†ä¾èµ–å™¨ä¹‹åï¼Œå¯åœ¨getterä¸­æ”¶é›†ä¾èµ–ï¼Œsetterä¸­é€šçŸ¥ä¾èµ–æ›´æ–°

    ```js
    function defineReative(obj, key, val) {
        if(arguments.length === 2) {
            val = obj[key]
        }
        if(typeof obj === 'object') {
            new Observer(val)
        }
        const dep = new Dep();
        Object.defineProperty(obj, key, {
            enumerable: true,
            configurable: true,
            get: function() {
                dep.depend(val)
                return val
            },
            set: function(newVal) {
                if(val === newVal) {
                    return
                }
                val = newVal
                dep.notify()
            }
        })
    }
    ```

    + å®é™…ä¾èµ–ï¼šè°ä½¿ç”¨äº†æ•°æ®ï¼Œè°å°±æ˜¯ä¾èµ–ï¼Œæˆ‘ä»¬å°±ä¸ºä¹‹åˆ›å»ºä¸€ä¸ª`watcher`å®ä¾‹ã€‚åœ¨åˆ›å»º`watcher`å®ä¾‹çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨ä¼šæŠŠè‡ªå·±æ·»åŠ åˆ°æ•°æ®å¯¹åº”çš„ä¾èµ–ç®¡ç†å™¨ä¸­ï¼Œä»¥åè¿™ä¸ª`watcher`å®ä¾‹å°±ä»£è¡¨è¿™ä¸ªä¾èµ–ï¼Œå½“æ•°æ®å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å°±é€šçŸ¥è¿™ä¸ª`watcher`å®ä¾‹ï¼Œç”±`watcher`å®ä¾‹å†å»é€šçŸ¥çœŸæ­£çš„ä¾èµ–

    + **æ€»ç»“**ï¼š`watcher`å…ˆæŠŠè‡ªå·±è®¾ç½®åˆ°å…¨å±€å”¯ä¸€æŒ‡å®šä½ç½®ï¼ˆwindow.targetï¼‰,ç„¶åè¯»å–æ•°æ®ã€‚å› ä¸ºè¯»å–äº†æ•°æ®ï¼Œæ‰€ä»¥ä¼šè§¦å‘è¿™ä¸ªæ•°æ®çš„`getter`ã€‚æ¥ç€ï¼Œåœ¨`getter`ä¸­å°±ä¼šä»å…¨å±€å”¯ä¸€çš„é‚£ä¸ªä½ç½®è¯»å–æ­£åœ¨è¯»å–æ•°æ®çš„`watcher`ï¼Œå¹¶æŠŠè¿™ä¸ª`watcher`æ”¶é›†åˆ°`Dep`ä¸­ã€‚æ”¶é›†å¥½ä¹‹åï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå‘`Dep`ä¸­æ¯ä¸ª`watcher`å‘é€é€šçŸ¥ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œ`watcher`å¯ä»¥ä¸»åŠ¨å»è®¢é˜…ä»»æ„ä¸€ä¸ªæ•°æ®çš„å˜åŒ–ã€‚å¦‚å›¾æ‰€ç¤º

      ![img](https://vue-js.com/learn-vue/assets/img/3.0b99330d.jpg)

    + **ä»¥ä¸Šæ–¹å¼çš„ç¼ºç‚¹ï¼š**Object.definePropertyè™½ç„¶å®ç°äº†å¯¹å¯¹è±¡æ•°æ®çš„å–å€¼å’Œè®¾ç½®å€¼ï¼Œä½†æ˜¯åœ¨å‘objectä¸­æ·»åŠ key/valueé”®å€¼å¯¹æˆ–è€…åˆ é™¤ä¸€å¯¹å·²æœ‰çš„key/valueé”®å€¼å¯¹æ—¶ï¼Œå®ƒæ˜¯æ— æ³•æ£€æµ‹åˆ°çš„ã€‚é’ˆå¯¹è¿™ä¸€é—®é¢˜Vueæä¾›äº†`vue.set`å’Œ`vue.delete`æ–¹æ³•é€šçŸ¥è§†å›¾æ›´æ–°

  + **æ€»ç»“æµç¨‹**

    1. `Data`é€šè¿‡`Observer`è½¬æ¢æˆäº†`getter\setter`çš„å½¢å¼æ¥è¿½è¸ªå˜åŒ–
    2. å½“å¤–ç•Œé€šè¿‡`watcher`è¯»å–æ•°æ®æ—¶ï¼Œä¼šè§¦å‘`getter` ä»è€Œå°†`watcher`æ·»åŠ åˆ°ä¾èµ–ã€‚
    3. å½“æ•°æ®æ–¹å¼å˜åŒ–æ—¶ï¼Œä¼šè§¦å‘`setter`,ä»è€Œå‘`Dep`ä¸­ä¾èµ–ï¼ˆå³`Watcher`ï¼‰å‘é€é€šçŸ¥ã€‚
    4. `Watcher`æ¥æ”¶åˆ°é€šçŸ¥åï¼Œä¼šå‘å¤–ç•Œå‘é€é€šçŸ¥ï¼Œå˜åŒ–é€šçŸ¥åˆ°å¤–ç•Œå¯èƒ½ä¼šè§¦å‘è§†å›¾æ›´æ–°ï¼Œä¹Ÿå¯èƒ½å‡ºå‘ç”¨æˆ·çš„æŸä¸ªå›è°ƒå‡½æ•°ç­‰ç­‰

  + **Arrayçš„å˜åŒ–æ£€æµ‹**ï¼šåœ¨è·å–æ•°æ®æ—¶æ”¶é›†ä¾èµ–ï¼Œæ•°æ®å˜åŒ–æ—¶ä¾èµ–æ›´æ–°

    + æ•°ç»„æ— æ³•ä½¿ç”¨`Object.defineProperty`æ–¹æ³•ï¼Œä½†æ˜¯åœ¨Vueä¸­æˆ‘ä»¬å®šä¹‰æ•°ç»„æ—¶å…¶å®ä¹Ÿæ˜¯æ”¾åœ¨ä¸€ä¸ª`object`å¯¹è±¡ä¸­ï¼Œåªè¦åœ¨è¿™ä¸ª`object`æ•°æ®å¯¹è±¡ä¸­è·å–è¿™ä¸ªæ•°ç»„çš„æ•°ç»„å°±ä¼šè§¦å‘`getter`,å³å¯åœ¨`getter`ä¸­æ”¶é›†ä¾èµ–

    + Vueä¸­åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„æ–¹æ³•æ‹¦æˆªå™¨ï¼Œå®ƒæ‹¦æˆªåœ¨æ•°ç»„å®ä¾‹ä¸`Array.property`ä¹‹é—´ï¼Œåœ¨æ‹¦æˆªå™¨å†…é‡å†™äº†æ“ä½œæ•°æ®çš„ä¸€äº›æ–¹æ³•ï¼Œå½“æ•°ç»„å®ä¾‹ä½¿ç”¨æ“ä½œæ•°ç»„æ–¹æ³•æ—¶ï¼Œå…¶å®ä½¿ç”¨çš„å°±æ˜¯æ‹¦æˆªå™¨é‡å†™çš„æ–¹æ³•ï¼Œè€Œä¸åœ¨ä½¿ç”¨`Array.prototype`ä¸Šçš„åŸç”Ÿæ–¹æ³•

      ![img](https://vue-js.com/learn-vue/assets/img/2.b446ab83.png)

      `Array`åŸå‹ä¸­å¯ä»¥æ”¹å˜æ•°ç»„è‡ªèº«å†…å®¹çš„æ–¹æ³•æœ‰7ä¸ªï¼š`push`ã€`pop`ã€`shift`ã€`unshift`ã€`splice`ã€`sort`ã€`reverse`

      ```js
      // æºç åœ°å€ï¼šsrc/core/observer/array.js
      const arrayProto = Array.prototype;
      // åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨
      export const arrayMethods = Object.create(arrayProto)
      // æ”¹å˜æ•°ç»„è‡ªèº«å†…å®¹çš„7ä¸ªæ–¹æ³•
      const methodsToPatch = ['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse']
      methodsToPatch.forEach(method => {
          const original = arrayProto[method] // ç¼“å­˜åŸç”Ÿæ–¹æ³•
          Object.defineProperty(arrayMethods, method, {
              enmuerable: false,
              configurable: true,
              widthable,
              value: function mutator(...args) {
                  const result = original.apply(this, args)
                  return result
              }
          })
      })
      
      ```

      

  

##### 1.2 Virtual DOM åŸç†ä»¥åŠdiffç®—æ³•

> + Virtual DOM: è™šæ‹ŸDOMï¼Œç”¨ä¸€ä¸ª`js`å¯¹è±¡æ¥æè¿°ä¸€ä¸ª`DOM`èŠ‚ç‚¹
>
> + ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOMï¼š vueæ˜¯æ•°æ®é©±åŠ¨è§†å›¾ï¼Œæ•°æ®å‘ç”Ÿå˜åŒ–è§†å›¾å°±è¦éšä¹‹å‘ç”Ÿå˜åŒ–ï¼Œåœ¨æ›´æ–°è§†å›¾çš„æ—¶å€™éš¾å…ä¼šæ“ä½œDOMï¼Œè€Œæ“ä½œçœŸå®Domæ˜¯éå¸¸è€—è´¹æ€§èƒ½ï¼Œä¸€ä¸ªçœŸæ­£çš„DOMæ˜¯éå¸¸åºå¤§çš„
> + äº§ç”Ÿçš„åŸå› å’Œæœ€å¤§çš„ç”¨é€”ï¼šä½¿ç”¨jsæ¨¡æ‹Ÿå‡ºçš„ä¸€ä¸ªdomèŠ‚ç‚¹ï¼Œç§°ä¹‹ä¸ºè™šæ‹ŸdomèŠ‚ç‚¹ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯¹æ¯”å˜åŒ–å‰åçš„è™šæ‹ŸdomèŠ‚ç‚¹ï¼Œé€šè¿‡`DOM-diff`ç®—æ³•è®¡ç®—å‡ºéœ€è¦æ›´æ–°çš„åœ°æ–¹ï¼Œç„¶åå†å»æ›´æ–°éœ€è¦æ›´æ–°çš„è§†å›¾

+ **Vnodeç±»**

  ```js
  // /æºç åœ°å€ï¼š src/core/vdom/vnode.js
  export default class VNode {
    constructor (
      tag?: string,
      data?: VNodeData,
      children?: ?Array<VNode>,
      text?: string,
      elm?: Node,
      context?: Component,
      componentOptions?: VNodeComponentOptions,
      asyncFactory?: Function
    ) {
      this.tag = tag                                /*å½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾å*/
      this.data = data        /*å½“å‰èŠ‚ç‚¹å¯¹åº”çš„å¯¹è±¡ï¼ŒåŒ…å«äº†å…·ä½“çš„ä¸€äº›æ•°æ®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªVNodeDataç±»å‹ï¼Œå¯ä»¥å‚è€ƒVNodeDataç±»å‹ä¸­çš„æ•°æ®ä¿¡æ¯*/
      this.children = children  /*å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„*/
      this.text = text     /*å½“å‰èŠ‚ç‚¹çš„æ–‡æœ¬*/
      this.elm = elm       /*å½“å‰è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå®domèŠ‚ç‚¹*/
      this.ns = undefined            /*å½“å‰èŠ‚ç‚¹çš„åå­—ç©ºé—´*/
      this.context = context          /*å½“å‰ç»„ä»¶èŠ‚ç‚¹å¯¹åº”çš„Vueå®ä¾‹*/
      this.fnContext = undefined       /*å‡½æ•°å¼ç»„ä»¶å¯¹åº”çš„Vueå®ä¾‹*/
      this.fnOptions = undefined
      this.fnScopeId = undefined
      this.key = data && data.key           /*èŠ‚ç‚¹çš„keyå±æ€§ï¼Œè¢«å½“ä½œèŠ‚ç‚¹çš„æ ‡å¿—ï¼Œç”¨ä»¥ä¼˜åŒ–*/
      this.componentOptions = componentOptions   /*ç»„ä»¶çš„optioné€‰é¡¹*/
      this.componentInstance = undefined       /*å½“å‰èŠ‚ç‚¹å¯¹åº”çš„ç»„ä»¶çš„å®ä¾‹*/
      this.parent = undefined           /*å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹*/
      this.raw = false         /*ç®€è€Œè¨€ä¹‹å°±æ˜¯æ˜¯å¦ä¸ºåŸç”ŸHTMLæˆ–åªæ˜¯æ™®é€šæ–‡æœ¬ï¼ŒinnerHTMLçš„æ—¶å€™ä¸ºtrueï¼ŒtextContentçš„æ—¶å€™ä¸ºfalse*/
      this.isStatic = false         /*é™æ€èŠ‚ç‚¹æ ‡å¿—*/
      this.isRootInsert = true      /*æ˜¯å¦ä½œä¸ºè·ŸèŠ‚ç‚¹æ’å…¥*/
      this.isComment = false             /*æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹*/
      this.isCloned = false           /*æ˜¯å¦ä¸ºå…‹éš†èŠ‚ç‚¹*/
      this.isOnce = false                /*æ˜¯å¦æœ‰v-onceæŒ‡ä»¤*/
      this.asyncFactory = asyncFactory
      this.asyncMeta = undefined
      this.isAsyncPlaceholder = false
    }
  
    get child (): Component | void {
      return this.componentInstance
    }
  }
  ```

  ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼š`Vnode`ç±»ä¸­åŒ…å«äº†æè¿°ä¸€ä¸ªçœŸå®`DOM`èŠ‚ç‚¹æ‰€éœ€è¦çš„ä¸€ç³»åˆ—å±æ€§ï¼Œå¦‚`tag`è¡¨ç¤ºèŠ‚ç‚¹æ ‡ç­¾åï¼Œ`text`è¡¨ç¤ºèŠ‚ç‚¹åŒ…å«çš„æ–‡æœ¬ï¼Œ`children`è¡¨ç¤ºè¯¥èŠ‚ç‚¹åŒ…å«çš„å­èŠ‚ç‚¹ç­‰ã€‚é€šè¿‡å±æ€§ä¹‹é—´ä¸åŒçš„æ­é…ï¼Œå°±å¯ä»¥æè¿°å‡ºå„ç§ç±»å‹çš„çœŸå®`DOM`èŠ‚ç‚¹

+ **Vnodeç±»å‹ï¼š** æ³¨é‡ŠèŠ‚ç‚¹ã€æ–‡æœ¬èŠ‚ç‚¹ã€å…ƒç´ èŠ‚ç‚¹ã€ç»„ä»¶èŠ‚ç‚¹ã€å‡½æ•°å¼ç»„ä»¶èŠ‚ç‚¹ã€å…‹éš†èŠ‚ç‚¹

  1. **æ³¨é‡ŠèŠ‚ç‚¹**ï¼šåªéœ€è¦ä¸¤ä¸ªå±æ€§

     ```js
     // åˆ›å»ºæ³¨é‡ŠèŠ‚ç‚¹
     export const createEmptyVNnode = (text: string) {
     	const node = new VNode()
     	node.text = text; // å…·ä½“çš„æ³¨é‡Šä¿¡æ¯
     	node.isComment = true; // æ ‡è¯†ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯æ³¨é‡ŠèŠ‚ç‚¹
     	return node
     }
     ```

  2. **æ–‡æœ¬èŠ‚ç‚¹**ï¼šæè¿°æ¯”æ³¨é‡ŠèŠ‚ç‚¹æ›´ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå±æ€§ï¼Œ`text`å±æ€§ï¼šç”¨æ¥è¡¨ç¤ºå…·ä½“çš„æ–‡æœ¬ä¿¡æ¯

     ```js
     // åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹
     export function createTextVNode(val: string | number) {
         return new VNode(underfind, underfind, underfind, String(val))
     }
     ```

  3. **å…‹éš†èŠ‚ç‚¹**ï¼šæŠŠä¸€ä¸ªå·²ç»å­˜åœ¨çš„å‡ ç‚¹å¤åˆ¶ä¸€ä»½å‡ºæ¥ï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†åšæ¨¡æ¿ç¼–è¯‘ä¼˜åŒ–æ—¶ä½¿ç”¨, ç°æœ‰èŠ‚ç‚¹ä¸æ–°å…‹éš†ç­‰åˆ°çš„å‡ ç‚¹å”¯ä¸€çš„åŒºåˆ«æ—¶`isCloned`ä¸º`true`

     ```js
     // åˆ›å»ºå…‹éš†èŠ‚ç‚¹
     export function cloneVNode (vnode: VNode): VNode {
       const cloned = new VNode(
         vnode.tag,
         vnode.data,
         vnode.children,
         vnode.text,
         vnode.elm,
         vnode.context,
         vnode.componentOptions,
         vnode.asyncFactory
       )
       cloned.ns = vnode.ns
       cloned.isStatic = vnode.isStatic
       cloned.key = vnode.key
       cloned.isComment = vnode.isComment
       cloned.fnContext = vnode.fnContext
       cloned.fnOptions = vnode.fnOptions
       cloned.fnScopeId = vnode.fnScopeId
       cloned.asyncMeta = vnode.asyncMeta
       cloned.isCloned = true
       return cloned
     }
     ```

  4. å…ƒç´ èŠ‚ç‚¹ï¼šè¿™ç§ç±»å‹çš„èŠ‚ç‚¹æ›´è´´è¿‘æˆ‘ä»¬é€šå¸¸çœ‹åˆ°çš„çœŸå®`DOM`èŠ‚ç‚¹ï¼Œå®ƒå…·æœ‰æè¿°èŠ‚ç‚¹æ ‡ç­¾åè¯çš„`tag`å±æ€§ï¼Œæè¿°èŠ‚ç‚¹å±æ€§å¦‚ï¼š`class`ã€`attrbutes`ç­‰çš„`data`å±æ€§ï¼Œæœ‰æè¿°åŒ…å«çš„å­èŠ‚ç‚¹ä¿¡æ¯çš„	`children`å±æ€§ç­‰ã€‚ç”±äºå…ƒç´ èŠ‚ç‚¹åŒ…å«çš„æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æºç ä¸­æ²¡æœ‰ç›´æ¥å†™æ­»

     ```js
     // çœŸå®DOMèŠ‚ç‚¹
     <div id='a'><span>éš¾å‡‰çƒ­è¡€</span></div>
     
     // VNodeèŠ‚ç‚¹
     {
       tag:'div',
       data:{},
       children:[
         {
           tag:'span',
           text:'éš¾å‡‰çƒ­è¡€'
         }
       ]
     }
     ```

  5. **ç»„ä»¶èŠ‚ç‚¹ï¼š**ç»„ä»¶èŠ‚ç‚¹ å‡ºäº†æœ‰å…ƒç´ èŠ‚ç‚¹å…·æœ‰çš„å±æ€§ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸¤ä¸ªç‰¹æœ‰çš„å±æ€§ï¼š

     + componentOptions: ç»„ä»¶çš„optioné€‰é¡¹ï¼Œå¦‚ç»„ä»¶çš„`props`ç­‰
     + componentInstanceï¼šå½“å‰ç»„ä»¶èŠ‚ç‚¹å¯¹åº”çš„`Vue`å®ä¾‹

  6. **å‡½æ•°å¼ç»„ä»¶èŠ‚ç‚¹**ï¼šå‡½æ•°å¼ç»„ä»¶èŠ‚ç‚¹ç›¸è¾ƒäºç»„ä»¶èŠ‚ç‚¹ï¼Œå®ƒåˆæœ‰ä¸¤ä¸ªç‰¹æœ‰çš„å±æ€§ï¼šã€‘

     + fnContextï¼šå‡½æ•°å¼ç»„ä»¶å¯¹åº”çš„Vueå®ä¾‹
     + fnOptionsï¼šç»„ä»¶çš„optioné€‰é¡¹

+ **VNodeæ€»ç»“**

  ä»¥jsçš„è®¡ç®—æ€§èƒ½æ¥æ¢å–æ“ä½œçœŸå®`DOM`æ‰€æ¶ˆè€—çš„æ€§èƒ½ã€‚åœ¨Vueä¸­æ˜¯é€šè¿‡VNodeç±»æ¥å®ä¾‹åŒ–å‡ºä¸åŒç±»å‹çš„è™šæ‹ŸdomèŠ‚ç‚¹ï¼Œå¹¶ä¸”å­¦ä¹ äº†ä¸åŒç±»å‹èŠ‚ç‚¹ç”Ÿäº§çš„å±æ€§ä¸åŒï¼Œæ‰€è°“ä¸åŒç±»å‹çš„èŠ‚ç‚¹å…¶æœ¬è´¨è¿˜æ˜¯ä¸€æ ·çš„å‘ƒï¼Œéƒ½æ˜¯Vnodeç±»çš„å®ä¾‹ï¼Œåªæ˜¯åœ¨å®ä¾‹åŒ–æ—¶ä¼ å…¥çš„å±æ€§å‚æ•°ä¸åŒç½¢äº†ã€‚VNodeçš„ä½œç”¨ï¼Œæœ‰äº†æ•°æ®å˜åŒ–å‰åçš„VNode,æˆ‘ä»¬æ‰èƒ½è¿›è¡Œåç»­çš„`DOM-diff`æ‰¾å‡º å·®å¼‚ï¼Œæœ€ååšåˆ°åªæ›´æ–°æœ‰å·®å¼‚çš„è§†å›¾ï¼Œä»è€Œè¾¾åˆ°å°½å¯èƒ½å°‘çš„æ“ä½œçœŸå®`DOM`çš„ç›®çš„ï¼Œä»¥èŠ‚çœæ€§èƒ½ã€‚
  
+ ##### **DOM-diffç®—æ³•**

  > DOM-diffè¿‡ç¨‹ï¼š VNodeçš„æœ€å¤§ç”¨é€”å°±æ˜¯åœ¨æ•°æ®å˜åŒ–å‰åç”ŸæˆçœŸå®DOMå¯¹åº”çš„è™šæ‹ŸDOMèŠ‚ç‚¹,ç„¶åå¯¹æ¯”æ–°æ—§ä¸¤ä»½VNodeï¼Œæ‰¾å‡ºå·®å¼‚æ‰€åœ¨ï¼Œç„¶åæ›´æ–°æœ‰å·®å¼‚çš„`DOM`èŠ‚ç‚¹ï¼Œæœ€ç»ˆè¾¾åˆ°ä»¥æœ€å°‘æ“ä½œçœŸå®`DOM`æ›´æ–°è§†å›¾çš„ç›®çš„ã€‚è€Œå¯¹æ¯”æ–°æ—§ä¸¤ä»½VNodeå¹¶æ‰¾å‡ºå·®å¼‚çš„è¿‡ç¨‹å°±æ˜¯`DOM-diff`è¿‡ç¨‹

  1. patchï¼šå…¶å®å°±æ˜¯DOM-diffè¿‡ç¨‹ï¼Œå³å¯¹æ—§çš„VNodeä¿®è¡¥ï¼Œæ‰“è¡¥ä¸ä»è€Œå¾—åˆ°æ–°å¾—VNode(**å¯¹æ¯”æ–°æ—§ä¸¤ä»½`VNode`çš„è¿‡ç¨‹ï¼Œä»¥æ–°çš„VNodeä¸ºåŸºå‡†ï¼Œæ”¹é€ æ—§çš„oldVNodeä½¿ä¹‹æˆä¸ºè·Ÿæ–°çš„VNodeä¸€æ ·ï¼Œè¿™å°±æ˜¯patchè¦å¹²çš„äº‹æƒ…**) ï¼Œå…¶å®åªå¹²äº†ä¸‰ä»¶äº‹æƒ…ï¼š

     1. åˆ›å»ºèŠ‚ç‚¹ï¼šæ–°çš„`VNode`ä¸­æœ‰è€Œæ—§çš„`vnode`ä¸­æ²¡æœ‰ï¼Œå°±åœ¨æ—§çš„`VNode`ä¸­åˆ›å»ºï¼›

        > Vnodeå¯ä»¥æè¿°6ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œå®é™…ä¸­åªæœ‰ä¸‰ç§ç±»å‹(**å…ƒç´ èŠ‚ç‚¹ã€æ–‡æœ¬èŠ‚ç‚¹ã€æ³¨é‡ŠèŠ‚ç‚¹**)çš„èŠ‚ç‚¹å¯ä»¥è¢«åˆ›å»ºå¹¶æ’å…¥åˆ°`DOM`ï¼Œvueåœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™å°±ä¼šåˆ¤æ–­åœ¨æ–°çš„`vnode`ä¸­æœ‰è€Œ	æ—§çš„`vnode`ä¸­æ²¡æœ‰çš„èŠ‚ç‚¹å±äºé‚£ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä»è€Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•åˆ›å»ºå¹¶æ’å…¥åˆ°DOMä¸­

        ```js
        // æºç ä½ç½®: /src/core/vdom/patch.js
        function createElm (vnode, parentElm, refElm) {
            const data = vnode.data
            const children = vnode.children
            const tag = vnode.tag
            if (isDef(tag)) {
              	vnode.elm = nodeOps.createElement(tag, vnode)   // åˆ›å»ºå…ƒç´ èŠ‚ç‚¹
                createChildren(vnode, children, insertedVnodeQueue) // åˆ›å»ºå…ƒç´ èŠ‚ç‚¹çš„å­èŠ‚ç‚¹
                insert(parentElm, vnode.elm, refElm)       // æ’å…¥åˆ°DOMä¸­
            } else if (isTrue(vnode.isComment)) {
              vnode.elm = nodeOps.createComment(vnode.text)  // åˆ›å»ºæ³¨é‡ŠèŠ‚ç‚¹
              insert(parentElm, vnode.elm, refElm)           // æ’å…¥åˆ°DOMä¸­
            } else {
              vnode.elm = nodeOps.createTextNode(vnode.text)  // åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹
              insert(parentElm, vnode.elm, refElm)           // æ’å…¥åˆ°DOMä¸­
            }
          }
        ```

        + åˆ¤æ–­æ˜¯å¦ä¸ºå…ƒç´ èŠ‚ç‚¹åªéœ€è¦åˆ¤æ–­`VNode`èŠ‚ç‚¹æ˜¯å¦æœ‰`tag`æ ‡ç­¾å³å¯ï¼Œè‹¥æœ‰åˆ™è®¤ä¸ºæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨`createElement`æ–¹æ³•åˆ›å»ºå…ƒç´ èŠ‚ç‚¹ï¼Œé€šå¸¸å…ƒç´ èŠ‚ç‚¹è¿˜ä¼šæœ‰å­èŠ‚ç‚¹ï¼Œé‚£å°±é€’å½’éå†åˆ›å»ºæ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå°†æ‰€æœ‰å­èŠ‚ç‚¹åˆ›å»ºå¥½ä¹‹å`insert`æ’å…¥åˆ°å½“å‰å…ƒç´ èŠ‚ç‚¹é‡Œé¢ï¼Œæœ€åæŠŠå½“å‰å…ƒç´ èŠ‚ç‚¹æ’å…¥åˆ°`DOM`ä¸­

        + åˆ¤æ–­æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹ï¼Œåªéœ€åˆ¤æ–­`VNode`çš„`isComment`å±æ€§æ˜¯å¦ä¸º`true`ã€‚è‹¥ä¸º`true`åˆ™ä¸ºæ³¨é‡ŠèŠ‚ç‚¹ï¼Œå°±è°ƒç”¨`createComment`æ–¹æ³•åˆ›å»ºæ³¨é‡ŠèŠ‚ç‚¹ï¼Œå†æ’å…¥åˆ°`DOM`ä¸­ã€‚

        + å¦‚æœæ—¢ä¸æ˜¯å…ƒç´ èŠ‚ç‚¹åˆä¸æ˜¯æ³¨é‡ŠèŠ‚ç‚¹ï¼Œé‚£å°±è®¤ä¸ºæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨`createTextNode`æ–¹æ³•åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œå†æ’å…¥åˆ°`DOM`ä¸­

          > ä»£ç ä¸­çš„`nodeOps`æ˜¯`vue`ä¸ºäº†è·¨å¹³å°å…¼å®¹æ€§ï¼Œå¯¹æ‰€æœ‰èŠ‚ç‚¹æ“ä½œè¿›è¡Œäº†å°è£…ï¼Œä¾‹å¦‚ï¼š`nodeOps.createTextNode()`åœ¨æµè§ˆå™¨ç«¯ç­‰åŒäº`document.createTextNode()`

          ![img](https://vue-js.com/learn-vue/assets/img/2.02d5c7b1.png)

     2. åˆ é™¤èŠ‚ç‚¹ï¼šæ–°çš„`VNode`ä¸­æ²¡æœ‰è€Œæ—§çš„`vnode`ä¸­æœ‰ï¼Œå°±åœ¨æ—§çš„`VNode`ä¸­åˆ é™¤ï¼›

        > å¦‚æœæŸäº›èŠ‚ç‚¹å†æ–°çš„`VNode`ä¸­æ²¡æœ‰è€Œåœ¨æ—§çš„`oldVNode`ä¸­æœ‰ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠè¿™äº›èŠ‚ç‚¹ä»æ—§çš„`oldVNode`ä¸­åˆ é™¤ã€‚åˆ é™¤èŠ‚ç‚¹éå¸¸ç®€å•ï¼Œåªéœ€åœ¨è¦åˆ é™¤èŠ‚ç‚¹çš„çˆ¶å…ƒç´ ä¸Šè°ƒç”¨`removeChild`æ–¹æ³•å³å¯

        ```js
        function removeNode (el) {
            const parent = nodeOps.parentNode(el)  // è·å–çˆ¶èŠ‚ç‚¹
            if (isDef(parent)) {
              nodeOps.removeChild(parent, el)  // è°ƒç”¨çˆ¶èŠ‚ç‚¹çš„removeChildæ–¹æ³•
            }
          }
        ```

        

     3. æ›´æ–°èŠ‚ç‚¹ï¼šæ–°çš„`VNode`å’Œæ—§çš„`vnode`ä¸­éƒ½æœ‰ï¼Œå°±ä»¥æ–°çš„`VNode`ä¸ºå‡†ï¼Œæ›´æ–°æ—§çš„`VNode`

        > å½“æŸäº›èŠ‚ç‚¹åœ¨æ–°çš„`VNode`å’Œæ—§çš„`oldVNode`ä¸­éƒ½æœ‰æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»†è‡´æ¯”è¾ƒä¸€ä¸‹ï¼Œæ‰¾å‡ºä¸ä¸€æ ·çš„åœ°æ–¹è¿›è¡Œæ›´æ–°
        >
        > **é™æ€èŠ‚ç‚¹**ï¼šè¯¥èŠ‚ç‚¹åªåŒ…å«äº†çº¯æ–‡å­—ï¼Œæ²¡æœ‰ä»»ä½•å¯å˜çš„å˜é‡ï¼Œä¸è®ºæ•°æ®å¦‚ä½•å˜åŒ–ï¼Œåªè¦è¿™ä¸ªèŠ‚ç‚¹ç¬¬ä¸€æ¬¡æ¸²æŸ“äº†ï¼Œé‚£ä¹ˆå®ƒä»¥åéƒ½ä¸ä¼šåœ¨å‘ç”Ÿå˜åŒ–äº†ï¼Œæ•°æ®å‘ç”Ÿä»»ä½•å˜åŒ–éƒ½ä¸ä»–æ— å…³

        ```js
        // æ›´æ–°èŠ‚ç‚¹
        function patchVnode (oldVnode, vnode, insertedVnodeQueue, removeOnly) {
          // vnodeä¸oldVnodeæ˜¯å¦å®Œå…¨ä¸€æ ·ï¼Ÿè‹¥æ˜¯ï¼Œé€€å‡ºç¨‹åº
          if (oldVnode === vnode) {
            return
          }
          const elm = vnode.elm = oldVnode.elm
        
          // vnodeä¸oldVnodeæ˜¯å¦éƒ½æ˜¯é™æ€èŠ‚ç‚¹ï¼Ÿè‹¥æ˜¯ï¼Œé€€å‡ºç¨‹åº
          if (isTrue(vnode.isStatic) &&
            isTrue(oldVnode.isStatic) &&
            vnode.key === oldVnode.key &&
            (isTrue(vnode.isCloned) || isTrue(vnode.isOnce))
          ) {
            return
          }
        
          const oldCh = oldVnode.children
          const ch = vnode.children
          // vnodeæœ‰textå±æ€§ï¼Ÿè‹¥æ²¡æœ‰ï¼š
          if (isUndef(vnode.text)) {
            // vnodeçš„å­èŠ‚ç‚¹ä¸oldVnodeçš„å­èŠ‚ç‚¹æ˜¯å¦éƒ½å­˜åœ¨ï¼Ÿ
            if (isDef(oldCh) && isDef(ch)) {
              // è‹¥éƒ½å­˜åœ¨ï¼Œåˆ¤æ–­å­èŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œä¸åŒåˆ™æ›´æ–°å­èŠ‚ç‚¹
              if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly)
            }
            // è‹¥åªæœ‰vnodeçš„å­èŠ‚ç‚¹å­˜åœ¨
            else if (isDef(ch)) {
              /**
               * åˆ¤æ–­oldVnodeæ˜¯å¦æœ‰æ–‡æœ¬ï¼Ÿ
               * è‹¥æ²¡æœ‰ï¼Œåˆ™æŠŠvnodeçš„å­èŠ‚ç‚¹æ·»åŠ åˆ°çœŸå®DOMä¸­
               * è‹¥æœ‰ï¼Œåˆ™æ¸…ç©ºDomä¸­çš„æ–‡æœ¬ï¼Œå†æŠŠvnodeçš„å­èŠ‚ç‚¹æ·»åŠ åˆ°çœŸå®DOMä¸­
               */
              if (isDef(oldVnode.text)) nodeOps.setTextContent(elm, '')
              addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue)
            }
            // è‹¥åªæœ‰oldnodeçš„å­èŠ‚ç‚¹å­˜åœ¨
            else if (isDef(oldCh)) {
              // æ¸…ç©ºDOMä¸­çš„å­èŠ‚ç‚¹
              removeVnodes(elm, oldCh, 0, oldCh.length - 1)
            }
            // è‹¥vnodeå’Œoldnodeéƒ½æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä½†æ˜¯oldnodeä¸­æœ‰æ–‡æœ¬
            else if (isDef(oldVnode.text)) {
              // æ¸…ç©ºoldnodeæ–‡æœ¬
              nodeOps.setTextContent(elm, '')
            }
            // ä¸Šé¢ä¸¤ä¸ªåˆ¤æ–­ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼Œå¦‚æœvnodeä¸­æ—¢æ²¡æœ‰textï¼Œä¹Ÿæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯¹åº”çš„oldnodeä¸­æœ‰ä»€ä¹ˆå°±æ¸…ç©ºä»€ä¹ˆ
          }
          // è‹¥æœ‰ï¼Œvnodeçš„textå±æ€§ä¸oldVnodeçš„textå±æ€§æ˜¯å¦ç›¸åŒï¼Ÿ
          else if (oldVnode.text !== vnode.text) {
            // è‹¥ä¸ç›¸åŒï¼šåˆ™ç”¨vnodeçš„textæ›¿æ¢çœŸå®DOMçš„æ–‡æœ¬
            nodeOps.setTextContent(elm, vnode.text)
          }
        }
        ```

        â€‹	![img](https://vue-js.com/learn-vue/assets/img/3.7b0442aa.png)

     1. å¦‚æœ`VNode`å’Œ`oldVNode`å‡ä¸ºé™æ€èŠ‚ç‚¹ï¼Œ ç›´æ¥ruturn

     2.  å¦‚æœ`VNode`æ˜¯æ–‡æœ¬èŠ‚ç‚¹:

        a. å¦‚æœ`oldVNode`ä¹Ÿæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œæ¯”è¾ƒä¸¤è€…æ–‡æœ¬ä¸ç›¸åŒï¼Œåˆ™æŠŠ`oldVNode`é‡Œçš„æ–‡æœ¬æ”¹æˆè·Ÿ`VNode`çš„æ–‡æœ¬ä¸€æ ·;

        b. å¦‚æœ`oldVNode`ä¸æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸è®ºå®ƒæ˜¯ä»€ä¹ˆï¼Œç›´æ¥è°ƒç”¨`setTextNode`æ–¹æ³•æŠŠå®ƒæ”¹æˆæ–‡æœ¬èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ–‡æœ¬å†…å®¹è·Ÿ`VNode`ç›¸åŒ

     3. å¦‚æœ`VNode`æ˜¯å…ƒç´ èŠ‚ç‚¹ï¼š

        + è¯¥èŠ‚ç‚¹åŒ…å«å­èŠ‚ç‚¹ï¼ˆğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ï¼‰

          å¦‚æœæ–°çš„èŠ‚ç‚¹å†…åŒ…å«äº†å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤æ—¶è¦çœ‹æ—§çš„èŠ‚ç‚¹æ˜¯å¦åŒ…å«å­èŠ‚ç‚¹ï¼Œå¦‚æœæ—§çš„èŠ‚ç‚¹é‡Œä¹ŸåŒ…å«äº†å­èŠ‚ç‚¹ï¼Œé‚£å°±éœ€è¦é€’å½’å¯¹æ¯”æ›´æ–°å­èŠ‚ç‚¹ï¼›å¦‚æœæ—§çš„èŠ‚ç‚¹é‡Œä¸åŒ…å«å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—§èŠ‚ç‚¹æœ‰å¯èƒ½æ˜¯ç©ºèŠ‚ç‚¹æˆ–è€…æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¦‚æœæ—§çš„èŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹å°±æŠŠæ–°çš„èŠ‚ç‚¹é‡Œçš„å­èŠ‚ç‚¹åˆ›å»ºä¸€ä»½ç„¶åæ’å…¥åˆ°æ—§çš„èŠ‚ç‚¹é‡Œé¢ï¼Œå¦‚æœæ—§çš„èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œåˆ™æŠŠæ–‡æœ¬æ¸…ç©ºï¼Œç„¶åæŠŠæ–°çš„èŠ‚ç‚¹é‡Œçš„å­èŠ‚ç‚¹åˆ›å»ºä¸€ä»½ç„¶åæ’å…¥åˆ°æ—§çš„èŠ‚ç‚¹é‡Œé¢ã€‚

        + è¯¥èŠ‚ç‚¹ä¸åŒ…å«å­èŠ‚ç‚¹

          å¦‚æœè¯¥èŠ‚ç‚¹ä¸åŒ…å«å­èŠ‚ç‚¹ï¼ŒåŒæ—¶å®ƒåˆä¸æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£å°±è¯´æ˜è¯¥èŠ‚ç‚¹æ˜¯ä¸ªç©ºèŠ‚ç‚¹ï¼Œé‚£å°±å¥½åŠäº†ï¼Œä¸ç®¡æ—§èŠ‚ç‚¹ä¹‹å‰é‡Œé¢éƒ½æœ‰å•¥ï¼Œç›´æ¥æ¸…ç©ºå³å¯ã€‚

     4. `VNode`æ˜¯å…ƒç´ èŠ‚ç‚¹åŒ…å«äº†å­èŠ‚ç‚¹ï¼ˆ**æ›´æ–°å­èŠ‚ç‚¹**ï¼‰

        å½“æ–°çš„`VNode`ä¸æ—§çš„`VNode`éƒ½æ˜¯å…ƒç´ èŠ‚ç‚¹ä¸”éƒ½åŒ…å«å­èŠ‚ç‚¹æ—¶ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„`VNode`å®ä¾‹ä¸Šçš„childrenå±æ€§æ˜¯åŒ…å«çš„å­èŠ‚ç‚¹æ•°ç»„ï¼Œæ–°`VNode`çš„å­èŠ‚ç‚¹ä¸º`newchildren`, æ—§`VNode`çš„å­èŠ‚ç‚¹ä¸º`oldChildren`ï¼Œå¤–å±‚å¾ªç¯`newchildren`å†…å±‚å¾ªç¯`oldChildren`ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå‡ºç°å››ç§æƒ…å†µï¼š

        + **åˆ›å»ºå­èŠ‚ç‚¹**ï¼šå¦‚æœ`newchildren`é‡Œé¢çš„æŸä¸ªå­èŠ‚ç‚¹åœ¨`oldChildren`é‡Œé¢æ‰¾ä¸åˆ°ç›¸åŒçš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¹‹å‰æ²¡æœ‰çš„ï¼Œæ‰€æœ‰éœ€è¦æ–°å¢è¿™ä¸ªèŠ‚ç‚¹ï¼Œå³åˆ›å»ºèŠ‚ç‚¹ï¼›ï¼ˆ**åˆé€‚çš„ä½ç½®æ˜¯æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹å‰ï¼Œè€Œå¹¶éæ‰€æœ‰å·²å¤„ç†èŠ‚ç‚¹ä¹‹å**ï¼‰

        + **åˆ é™¤å­èŠ‚ç‚¹**ï¼šå¦‚æœ`newchildren`å¾ªç¯å®Œæ¯•åï¼Œ`oldChildren`é‡Œé¢è¿˜æœ‰æœªå¤„ç†çš„å­èŠ‚ç‚¹ï¼Œé‚£è¯´æ˜è¿™äº›èŠ‚ç‚¹æ˜¯è¦è¢«åºŸå¼ƒçš„ï¼Œå¤„ç†åˆ é™¤å³å¯

        + **ç§»åŠ¨å­èŠ‚ç‚¹ï¼š**å¦‚æœ`newchildren`é‡Œé¢çš„æŸä¸ªå­èŠ‚ç‚¹åœ¨`oldChildren`é‡Œé¢æ‰¾åˆ°äº†ç›¸åŒèŠ‚ç‚¹ï¼Œä½†æ˜¯æ‰€å¤„ä½ç½®ä¸åŒï¼Œé‚£ä¹ˆéœ€è¦ä»¥`newchildren`é‡Œé¢çš„å­èŠ‚ç‚¹ä¸ºåŸºå‡†ï¼Œè°ƒæ•´`oldChildren`é‡Œè¯¥èŠ‚ç‚¹çš„ä½ç½®ï¼Œä½¿ä¹‹ä¸åœ¨`newchildren`çš„ä½ç½®ç›¸åŒ

        + **æ›´æ–°å­èŠ‚ç‚¹ï¼š**å¦‚æœ`newchildren`é‡Œé¢çš„æŸä¸ªå­èŠ‚ç‚¹åœ¨`oldChildren`é‡Œé¢æ‰¾åˆ°äº†ç›¸åŒèŠ‚ç‚¹ï¼Œä¸”æ‰€å¤„ä½ç½®ä¹Ÿæ˜¯ç›¸åŒï¼Œé‚£ä¹ˆç›´æ¥åœ¨`oldChildren`ä¸­æ›´æ–°è¯¥èŠ‚ç‚¹ï¼Œä½¿ä¹‹ä¸`newChildren`é‡Œçš„è¯¥èŠ‚ç‚¹ç›¸åŒ

          ```js
          // æºç ä½ç½®ï¼š /src/core/vdom/patch.js
          if (isUndef(idxInOld)) {    // å¦‚æœåœ¨oldChildrené‡Œæ‰¾ä¸åˆ°å½“å‰å¾ªç¯çš„newChildrené‡Œçš„å­èŠ‚ç‚¹
              // æ–°å¢èŠ‚ç‚¹å¹¶æ’å…¥åˆ°åˆé€‚ä½ç½®
              createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)
          } else {
              // å¦‚æœåœ¨oldChildrené‡Œæ‰¾åˆ°äº†å½“å‰å¾ªç¯çš„newChildrené‡Œçš„å­èŠ‚ç‚¹
              vnodeToMove = oldCh[idxInOld]
              // å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ç›¸åŒ
              if (sameVnode(vnodeToMove, newStartVnode)) {
                  // è°ƒç”¨patchVnodeæ›´æ–°èŠ‚ç‚¹
                  patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue)
                  oldCh[idxInOld] = undefined
                  // canmoveè¡¨ç¤ºæ˜¯å¦éœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼Œå¦‚æœä¸ºtrueè¡¨ç¤ºéœ€è¦ç§»åŠ¨ï¼Œåˆ™ç§»åŠ¨èŠ‚ç‚¹ï¼Œå¦‚æœä¸ºfalseåˆ™ä¸ç”¨ç§»åŠ¨
                  canMove && nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)
              }
          }
          ```

          ```js
          canMove && nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)
          // ç­‰åŒäº
          if(canMove){
              nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)
          }
          ```

     5. **ä¼˜åŒ–æ›´æ–°å­èŠ‚ç‚¹**ï¼ˆğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ï¼‰

        > å†…å¤–ä¾§å¾ªç¯å¯è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯å­˜åœ¨å½“åŒ…å«å­èŠ‚ç‚¹æ•°é‡å¾ˆå¤šæ—¶ã€‚è¿™æ ·å¾ªç¯ç®—æ³•çš„äº‹ä»¶å¤æ‚åº¦å°±ä¼šå˜çš„å¾ˆå¤§ï¼Œä¸åˆ©äºæ€§èƒ½æå‡ï¼Œvueå¯¹æ­¤è¿›è¡Œäº†ä¼˜åŒ–å‡çº§

        1. ä¼˜åŒ–ç­–ç•¥

           æŒ‰ç…§æ—§æ–¹æ³•ä¼šå­˜åœ¨ç®—æ³•æ—¶é—´å¤æ‚åº¦å°±ä¼šéå¸¸é«˜ï¼Œä¸åˆ©äºæ€§èƒ½æå‡

           ä¼˜åŒ–ç­–ç•¥å¯ä»¥ä¸ç”¨æŒ‰ç…§é¡ºåºå»å¾ªç¯`newChildren`å’Œ`oldChildren`è¿™ä¸¤ä¸ªæ•°ç»„ï¼Œå¯ä»¥å…ˆæ¯”è¾ƒè¿™ä¸¤ä¸ªæ•°ç»„é‡Œç‰¹æ®Šä½ç½®çš„å­èŠ‚ç‚¹ï¼ˆ**ä»ä¸¤è¾¹å‘ä¸­é—´æ‰¾**ï¼‰

           ![img](https://vue-js.com/learn-vue/assets/img/8.e4c85c40.png)

           + `newChildren`æ•°ç»„é‡Œçš„æ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç§°ä¸ºï¼š**æ–°å‰**ï¼›
           + `newChildren`æ•°ç»„é‡Œçš„æ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ç§°ä¸ºï¼š**æ–°å**ï¼›
           + `oldChildren`æ•°ç»„é‡Œçš„æ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç§°ä¸ºï¼š**æ—§å‰**ï¼›
           + `oldChildren`æ•°ç»„é‡Œçš„æ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ç§°ä¸ºï¼š**æ—§å**ï¼›

           1. ## æ–°å‰ä¸æ—§å‰

              æŠŠ`newChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å’Œ`oldChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹åšæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œé‚£å°±ç›´æ¥è¿›å…¥æ›´æ–°èŠ‚ç‚¹çš„æ“ä½œï¼Œæ›´æ–°å®Œåå†å°†`oldChildren`æ•°ç»„é‡Œçš„è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°ä¸`newChildren`æ•°ç»„é‡ŒèŠ‚ç‚¹ç›¸åŒçš„ä½ç½®ï¼›

              ![img](https://vue-js.com/learn-vue/assets/img/9.e017b452.png)

           2. ## æ–°åä¸æ—§å

              æŠŠ`newChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å’Œ`oldChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹åšæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œé‚£å°±ç›´æ¥è¿›å…¥æ›´æ–°èŠ‚ç‚¹çš„æ“ä½œå¹¶ä¸”ç”±äºæ–°åä¸æ—§åä¸¤ä¸ªèŠ‚ç‚¹çš„ä½ç½®ä¹Ÿç›¸åŒï¼Œæ— éœ€è¿›è¡ŒèŠ‚ç‚¹ç§»åŠ¨æ“ä½œï¼›å¦‚æœä¸åŒï¼Œç»§ç»­å¾€åå°è¯•ã€‚

              ![img](https://vue-js.com/learn-vue/assets/img/10.cf98adc0.png)

           3. ## æ–°åä¸æ—§å‰

              æŠŠ`newChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å’Œ`oldChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹åšæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œé‚£å°±ç›´æ¥è¿›å…¥æ›´æ–°èŠ‚ç‚¹çš„æ“ä½œï¼Œæ›´æ–°å®Œåå†å°†`oldChildren`æ•°ç»„é‡Œçš„è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°ä¸`newChildren`æ•°ç»„é‡ŒèŠ‚ç‚¹ç›¸åŒçš„ä½ç½®ï¼›

              ![img](https://vue-js.com/learn-vue/assets/img/11.2ddb5ee5.png)

              æ­¤æ—¶ï¼Œå‡ºç°äº†ç§»åŠ¨èŠ‚ç‚¹çš„æ“ä½œï¼Œç§»åŠ¨èŠ‚ç‚¹æœ€å…³é”®çš„åœ°æ–¹åœ¨äºæ‰¾å‡†è¦ç§»åŠ¨çš„ä½ç½®ã€‚æˆ‘ä»¬ä¸€å†å¼ºè°ƒï¼Œ**æ›´æ–°èŠ‚ç‚¹è¦ä»¥æ–°`VNode`ä¸ºåŸºå‡†ï¼Œç„¶åæ“ä½œæ—§çš„`oldVNode`ï¼Œä½¿ä¹‹æœ€åæ—§çš„`oldVNode`ä¸æ–°çš„`VNode`ç›¸åŒ**ã€‚é‚£ä¹ˆç°åœ¨çš„æƒ…å†µæ˜¯ï¼š`newChildren`æ•°ç»„é‡Œçš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ä¸`oldChildren`æ•°ç»„é‡Œçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥åœ¨`oldChildren`æ•°ç»„é‡ŒæŠŠç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç§»åŠ¨åˆ°æœ€åä¸€ä¸ªå­èŠ‚ç‚¹çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š

              ![img](https://vue-js.com/learn-vue/assets/img/12.bace2f7f.png)

              ä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬è¦æŠŠ`oldChildren`æ•°ç»„é‡ŒæŠŠç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç§»åŠ¨åˆ°æ•°ç»„ä¸­**æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹å**ã€‚

              å¦‚æœå¯¹æ¯”ä¹‹åå‘ç°è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä»ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£å°±ç»§ç»­å°è¯•æœ€åä¸€ç§æƒ…å†µã€‚

           4. ## æ–°å‰ä¸æ—§å

              æŠŠ`newChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å’Œ`oldChildren`æ•°ç»„é‡Œæ‰€æœ‰æœªå¤„ç†å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹åšæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œé‚£å°±ç›´æ¥è¿›å…¥æ›´æ–°èŠ‚ç‚¹çš„æ“ä½œï¼Œæ›´æ–°å®Œåå†å°†`oldChildren`æ•°ç»„é‡Œçš„è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°ä¸`newChildren`æ•°ç»„é‡ŒèŠ‚ç‚¹ç›¸åŒçš„ä½ç½®ï¼›

              ![img](https://vue-js.com/learn-vue/assets/img/13.98dbc208.png)

              åŒæ ·ï¼Œè¿™ç§æƒ…å†µçš„èŠ‚ç‚¹ç§»åŠ¨ä½ç½®é€»è¾‘ä¸â€œæ–°åä¸æ—§å‰â€çš„é€»è¾‘ç±»ä¼¼ï¼Œé‚£å°±æ˜¯`newChildren`æ•°ç»„é‡Œçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¸`oldChildren`æ•°ç»„é‡Œçš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥åœ¨`oldChildren`æ•°ç»„é‡ŒæŠŠæœ€åä¸€ä¸ªå­èŠ‚ç‚¹ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š

              ![img](https://vue-js.com/learn-vue/assets/img/14.18c1c6dd.png)

              ä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬è¦æŠŠ`oldChildren`æ•°ç»„é‡ŒæŠŠæœ€åä¸€ä¸ªå­èŠ‚ç‚¹ç§»åŠ¨åˆ°æ•°ç»„ä¸­**æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹å‰**ã€‚

              OKï¼Œä»¥ä¸Šå°±æ˜¯å­èŠ‚ç‚¹å¯¹æ¯”æ›´æ–°ä¼˜åŒ–ç­–ç•¥ç§çš„4ç§æƒ…å†µï¼Œå¦‚æœä»¥ä¸Š4ç§æƒ…å†µé€ä¸ªè¯•éä¹‹åè¦æ˜¯è¿˜æ²¡æ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹ï¼Œé‚£å°±å†é€šè¿‡ä¹‹å‰çš„å¾ªç¯æ–¹å¼æŸ¥æ‰¾ã€‚

           5. ## æºç 

              ```js
              // å¾ªç¯æ›´æ–°å­èŠ‚ç‚¹
                function updateChildren (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) {
                  let oldStartIdx = 0               // oldChildrenå¼€å§‹ç´¢å¼•
                  let oldEndIdx = oldCh.length - 1   // oldChildrenç»“æŸç´¢å¼•
                  let oldStartVnode = oldCh[0]        // oldChildrenä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ª
                  let oldEndVnode = oldCh[oldEndIdx]   // oldChildrenä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¸­çš„æœ€åä¸€ä¸ª
              
                  let newStartIdx = 0               // newChildrenå¼€å§‹ç´¢å¼•
                  let newEndIdx = newCh.length - 1   // newChildrenç»“æŸç´¢å¼•
                  let newStartVnode = newCh[0]        // newChildrenä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ª
                  let newEndVnode = newCh[newEndIdx]  // newChildrenä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¸­çš„æœ€åä¸€ä¸ª
              
                  let oldKeyToIdx, idxInOld, vnodeToMove, refElm
              
                  // removeOnly is a special flag used only by <transition-group>
                  // to ensure removed elements stay in correct relative positions
                  // during leaving transitions
                  const canMove = !removeOnly
              
                  if (process.env.NODE_ENV !== 'production') {
                    checkDuplicateKeys(newCh)
                  }
              
                  // ä»¥"æ–°å‰"ã€"æ–°å"ã€"æ—§å‰"ã€"æ—§å"çš„æ–¹å¼å¼€å§‹æ¯”å¯¹èŠ‚ç‚¹
                  while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {
                    if (isUndef(oldStartVnode)) {
                      oldStartVnode = oldCh[++oldStartIdx] // å¦‚æœoldStartVnodeä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è·³è¿‡ï¼Œæ¯”å¯¹ä¸‹ä¸€ä¸ª
                    } else if (isUndef(oldEndVnode)) {
                      oldEndVnode = oldCh[--oldEndIdx]
                    } else if (sameVnode(oldStartVnode, newStartVnode)) {
                      // å¦‚æœæ–°å‰ä¸æ—§å‰èŠ‚ç‚¹ç›¸åŒï¼Œå°±æŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œpatchæ›´æ–°
                      patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue)
                      oldStartVnode = oldCh[++oldStartIdx]
                      newStartVnode = newCh[++newStartIdx]
                    } else if (sameVnode(oldEndVnode, newEndVnode)) {
                      // å¦‚æœæ–°åä¸æ—§åèŠ‚ç‚¹ç›¸åŒï¼Œå°±æŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œpatchæ›´æ–°
                      patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue)
                      oldEndVnode = oldCh[--oldEndIdx]
                      newEndVnode = newCh[--newEndIdx]
                    } else if (sameVnode(oldStartVnode, newEndVnode)) { // Vnode moved right
                      // å¦‚æœæ–°åä¸æ—§å‰èŠ‚ç‚¹ç›¸åŒï¼Œå…ˆæŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œpatchæ›´æ–°ï¼Œç„¶åæŠŠæ—§å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°oldChilrenä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹å
                      patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue)
                      canMove && nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))
                      oldStartVnode = oldCh[++oldStartIdx]
                      newEndVnode = newCh[--newEndIdx]
                    } else if (sameVnode(oldEndVnode, newStartVnode)) { // Vnode moved left
                      // å¦‚æœæ–°å‰ä¸æ—§åèŠ‚ç‚¹ç›¸åŒï¼Œå…ˆæŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œpatchæ›´æ–°ï¼Œç„¶åæŠŠæ—§åèŠ‚ç‚¹ç§»åŠ¨åˆ°oldChilrenä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹å‰
                      patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue)
                      canMove && nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)
                      oldEndVnode = oldCh[--oldEndIdx]
                      newStartVnode = newCh[++newStartIdx]
                    } else {
                      // å¦‚æœä¸å±äºä»¥ä¸Šå››ç§æƒ…å†µï¼Œå°±è¿›è¡Œå¸¸è§„çš„å¾ªç¯æ¯”å¯¹patch
                      if (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)
                      idxInOld = isDef(newStartVnode.key)
                        ? oldKeyToIdx[newStartVnode.key]
                        : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)
                      // å¦‚æœåœ¨oldChildrené‡Œæ‰¾ä¸åˆ°å½“å‰å¾ªç¯çš„newChildrené‡Œçš„å­èŠ‚ç‚¹
                      if (isUndef(idxInOld)) { // New element
                        // æ–°å¢èŠ‚ç‚¹å¹¶æ’å…¥åˆ°åˆé€‚ä½ç½®
                        createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)
                      } else {
                        // å¦‚æœåœ¨oldChildrené‡Œæ‰¾åˆ°äº†å½“å‰å¾ªç¯çš„newChildrené‡Œçš„å­èŠ‚ç‚¹
                        vnodeToMove = oldCh[idxInOld]
                        // å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ç›¸åŒ
                        if (sameVnode(vnodeToMove, newStartVnode)) {
                          // è°ƒç”¨patchVnodeæ›´æ–°èŠ‚ç‚¹
                          patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue)
                          oldCh[idxInOld] = undefined
                          // canmoveè¡¨ç¤ºæ˜¯å¦éœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼Œå¦‚æœä¸ºtrueè¡¨ç¤ºéœ€è¦ç§»åŠ¨ï¼Œåˆ™ç§»åŠ¨èŠ‚ç‚¹ï¼Œå¦‚æœä¸ºfalseåˆ™ä¸ç”¨ç§»åŠ¨
                          canMove && nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)
                        } else {
                          // same key but different element. treat as new element
                          createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)
                        }
                      }
                      newStartVnode = newCh[++newStartIdx]
                    }
                  }
                  if (oldStartIdx > oldEndIdx) {
                    /**
                     * å¦‚æœoldChildrenæ¯”newChildrenå…ˆå¾ªç¯å®Œæ¯•ï¼Œ
                     * é‚£ä¹ˆnewChildrené‡Œé¢å‰©ä½™çš„èŠ‚ç‚¹éƒ½æ˜¯éœ€è¦æ–°å¢çš„èŠ‚ç‚¹ï¼Œ
                     * æŠŠ[newStartIdx, newEndIdx]ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ’å…¥åˆ°DOMä¸­
                     */
                    refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm
                    addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)
                  } else if (newStartIdx > newEndIdx) {
                    /**
                     * å¦‚æœnewChildrenæ¯”oldChildrenå…ˆå¾ªç¯å®Œæ¯•ï¼Œ
                     * é‚£ä¹ˆoldChildrené‡Œé¢å‰©ä½™çš„èŠ‚ç‚¹éƒ½æ˜¯éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œ
                     * æŠŠ[oldStartIdx, oldEndIdx]ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åˆ é™¤
                     */
                    removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)
                  }
                }
              ```

              ä¼˜åŒ–ç­–ç•¥ä¸­ï¼ŒèŠ‚ç‚¹æœ‰å¯èƒ½æ˜¯ä»å‰é¢å¯¹æ¯”ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä»åé¢å¯¹æ¯”ï¼Œå¯¹æ¯”æˆåŠŸå°±ä¼šè¿›è¡Œæ›´æ–°å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœ‰å¯èƒ½å¤„ç†ç¬¬ä¸€ä¸ªï¼Œä¹Ÿæœ‰å¯èƒ½å¤„ç†æœ€åä¸€ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å¾ªç¯çš„æ—¶å€™å°±ä¸èƒ½ç®€å•ä»å‰å¾€åæˆ–ä»åå¾€å‰å¾ªç¯ï¼Œè€Œæ˜¯è¦ä»ä¸¤è¾¹å‘ä¸­é—´å¾ªç¯

              ![img](https://vue-js.com/learn-vue/assets/img/15.e9bdf5c1.png)

              + **newStartIdx:**`newChildren`æ•°ç»„é‡Œå¼€å§‹ä½ç½®çš„ä¸‹æ ‡ï¼›
              + **newEndIdx:**`newChildren`æ•°ç»„é‡Œç»“æŸä½ç½®çš„ä¸‹æ ‡ï¼›
              + **oldStartIdx:**`oldChildren`æ•°ç»„é‡Œå¼€å§‹ä½ç½®çš„ä¸‹æ ‡ï¼›
              + **oldEndIdx:**`oldChildren`æ•°ç»„é‡Œç»“æŸä½ç½®çš„ä¸‹æ ‡ï¼›

              **ä¼˜åŒ–ç­–ç•¥æ˜¯æ–°æ—§èŠ‚ç‚¹ä¸¤ä¸¤æ›´æ–°ï¼Œä¸€æ¬¡æ›´æ–°å°†ä¼šç§»åŠ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼š`newStartIdx`å’Œ`oldStartIdx`åªèƒ½å¾€åç§»åŠ¨ï¼ˆåªä¼šåŠ ï¼‰ï¼Œ`newEndIdx`å’Œ`oldEndIdx`åªèƒ½å¾€å‰ç§»åŠ¨ï¼ˆåªä¼šå‡ï¼‰**

              å½“å¼€å§‹ä½ç½®å¤§äºç»“æŸä½ç½®æ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰èŠ‚ç‚¹éƒ½å·²ç»éå†è¿‡äº†

              1. å¦‚æœ`oldStartVnode`ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è·³è¿‡ï¼Œå°†`oldStartIdx`åŠ 1ï¼Œæ¯”å¯¹ä¸‹ä¸€ä¸ª

                 ```js
                 // ä»¥"æ–°å‰"ã€"æ–°å"ã€"æ—§å‰"ã€"æ—§å"çš„æ–¹å¼å¼€å§‹æ¯”å¯¹èŠ‚ç‚¹
                 while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {
                 	if (isUndef(oldStartVnode)) {
                         oldStartVnode = oldCh[++oldStartIdx]
                       }
                 }
                 ```

              2. å¦‚æœ`oldEndVnode`ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è·³è¿‡ï¼Œå°†`oldEndIdx`å‡1ï¼Œæ¯”å¯¹å‰ä¸€ä¸ª

                 ```js
                 else if (isUndef(oldEndVnode)) {
                     oldEndVnode = oldCh[--oldEndIdx]
                 }
                 ```

              3. å¦‚æœæ–°å‰ä¸æ—§å‰èŠ‚ç‚¹ç›¸åŒï¼Œå°±æŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œ`patch`æ›´æ–°ï¼ŒåŒæ—¶`oldStartIdx`å’Œ`newStartIdx`éƒ½åŠ 1ï¼Œåç§»ä¸€ä¸ªä½ç½®

                 ```js
                 else if (sameVnode(oldStartVnode, newStartVnode)) {
                     patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue)
                     oldStartVnode = oldCh[++oldStartIdx]
                     newStartVnode = newCh[++newStartIdx]
                 }
                 ```

              4. å¦‚æœæ–°åä¸æ—§åèŠ‚ç‚¹ç›¸åŒï¼Œå°±æŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œ`patch`æ›´æ–°ï¼ŒåŒæ—¶`oldEndIdx`å’Œ`newEndIdx`éƒ½å‡1ï¼Œå‰ç§»ä¸€ä¸ªä½ç½®

                 ```js
                 else if (sameVnode(oldEndVnode, newEndVnode)) {
                     patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue)
                     oldEndVnode = oldCh[--oldEndIdx]
                     newEndVnode = newCh[--newEndIdx]
                 }
                 ```

              5. å¦‚æœæ–°åä¸æ—§å‰èŠ‚ç‚¹ç›¸åŒï¼Œå…ˆæŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œ`patch`æ›´æ–°ï¼Œç„¶åæŠŠæ—§å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°`oldChilren`ä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹åï¼Œæœ€åæŠŠ`oldStartIdx`åŠ 1ï¼Œåç§»ä¸€ä¸ªä½ç½®ï¼Œ`newEndIdx`å‡1ï¼Œå‰ç§»ä¸€ä¸ªä½ç½®

                 ```js
                 else if (sameVnode(oldStartVnode, newEndVnode)) {
                     patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue)
                     canMove && nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))
                     oldStartVnode = oldCh[++oldStartIdx]
                     newEndVnode = newCh[--newEndIdx]
                 }
                 ```

              6. å¦‚æœæ–°å‰ä¸æ—§åèŠ‚ç‚¹ç›¸åŒï¼Œå…ˆæŠŠä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œ`patch`æ›´æ–°ï¼Œç„¶åæŠŠæ—§åèŠ‚ç‚¹ç§»åŠ¨åˆ°`oldChilren`ä¸­æ‰€æœ‰æœªå¤„ç†èŠ‚ç‚¹ä¹‹å‰ï¼Œæœ€åæŠŠ`newStartIdx`åŠ 1ï¼Œåç§»ä¸€ä¸ªä½ç½®ï¼Œ`oldEndIdx`å‡1ï¼Œå‰ç§»ä¸€ä¸ªä½ç½®

                 ```js
                 else if (sameVnode(oldEndVnode, newStartVnode)) { // Vnode moved left
                     patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue)
                     canMove && nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)
                     oldEndVnode = oldCh[--oldEndIdx]
                     newStartVnode = newCh[++newStartIdx]
                 }
                 ```

              7. å¦‚æœä¸å±äºä»¥ä¸Šå››ç§æƒ…å†µï¼Œå°±è¿›è¡Œå¸¸è§„çš„å¾ªç¯æ¯”å¯¹`patch`

              8. å¦‚æœåœ¨å¾ªç¯ä¸­ï¼Œ`oldStartIdx`å¤§äº`oldEndIdx`äº†ï¼Œé‚£å°±è¡¨ç¤º`oldChildren`æ¯”`newChildren`å…ˆå¾ªç¯å®Œæ¯•ï¼Œé‚£ä¹ˆ`newChildren`é‡Œé¢å‰©ä½™çš„èŠ‚ç‚¹éƒ½æ˜¯éœ€è¦æ–°å¢çš„èŠ‚ç‚¹ï¼ŒæŠŠ`[newStartIdx, newEndIdx]`ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ’å…¥åˆ°`DOM`ä¸­

                 ```js
                 if (oldStartIdx > oldEndIdx) {
                     refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm
                     addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)
                 }
                 ```

              9. å¦‚æœåœ¨å¾ªç¯ä¸­ï¼Œ`newStartIdx`å¤§äº`newEndIdx`äº†ï¼Œé‚£å°±è¡¨ç¤º`newChildren`æ¯”`oldChildren`å…ˆå¾ªç¯å®Œæ¯•ï¼Œé‚£ä¹ˆ`oldChildren`é‡Œé¢å‰©ä½™çš„èŠ‚ç‚¹éƒ½æ˜¯éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼ŒæŠŠ`[oldStartIdx, oldEndIdx]`ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åˆ é™¤

                 ```js
                 else if (newStartIdx > newEndIdx) {
                     removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)
                 }
                 ```

                 

              10. æ€»ç»“ï¼šVueä¸ºäº†é¿å…åŒé‡å¾ªç¯æ•°æ®é‡å¤§æ—¶é—´å¤æ‚åº¦å‡é«˜å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œè€Œé€‰æ‹©äº†ä»å­èŠ‚ç‚¹æ•°ç»„ä¸­çš„4ä¸ªç‰¹æ®Šä½ç½®äº’ç›¸æ¯”å¯¹ï¼Œåˆ†åˆ«æ˜¯ï¼šæ–°å‰å’Œæ—§åï¼Œæ–°åå’Œæ—§åï¼Œæ–°åå’Œæ—§å‰ï¼Œæ–°å‰å’Œæ—§åã€‚

  ##### 1.3 æ¨¡æ¿ç¼–è¯‘

  > æŠŠç”¨æˆ·åœ¨`<template></template>`æ ‡ç­¾ä¸­å†™çš„ç±»ä¼¼äºåŸç”Ÿ`html`çš„å†…å®¹è¿›è¡Œç¼–è¯‘ï¼ŒæŠŠåŸç”Ÿ`html`çš„å†…å®¹æ‰¾å‡ºæ¥ï¼Œå†æŠŠéåŸç”Ÿ`html`æ‰¾å‡ºæ¥ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„é€»è¾‘å¤„ç†ç”Ÿæˆæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯`render`å‡½æ•°çš„è¿™ä¸€æ®µè¿‡ç¨‹ç§°ä¸ºæ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹

  ###### 1.3.1 æ•´ä½“æ¸²æŸ“æµç¨‹

  æ‰€è°“æ¸²æŸ“æµç¨‹ï¼Œå°±æ˜¯å§ç”¨æˆ·å†™çš„ç±»ä¼¼äºåŸç”Ÿ`html`çš„æ¨¡æ¿ç»è¿‡ä¸€ç³»åˆ—å¤„ç†æœ€ç»ˆååº”åˆ°è§†å›¾ç§°ä¹‹ä¸ºæ•´ä¸ªæ¸²æŸ“æµç¨‹

  ![img](https://vue-js.com/learn-vue/assets/img/1.f0570125.png)

  ###### 1.3.2 æ¨¡æ¿ç¼–è¯‘å†…éƒ¨æµç¨‹

  1. æŠ½è±¡è¯­æ³•ä¹¦AST

     > æŠ½è±¡è¯­æ³•æ ‘ï¼šåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ**æŠ½è±¡è¯­æ³•æ ‘**ï¼ˆ**A**bstract**S**yntax**T**reeï¼ŒASTï¼‰ï¼Œæˆ–ç®€ç§°**è¯­æ³•æ ‘**ï¼ˆSyntax treeï¼‰ï¼Œæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚ä¹‹æ‰€ä»¥è¯´è¯­æ³•æ˜¯æŠ½è±¡çš„ï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„è¯­æ³•å¹¶ä¸ä¼šè¡¨ç¤ºå‡ºçœŸå®è¯­æ³•ä¸­å‡ºç°çš„æ¯ä¸ªç»†èŠ‚

  ![img](https://vue-js.com/learn-vue/assets/img/2.5596631a.png)

  2. å…·ä½“æµç¨‹

     å°†ä¸€å †å­—ç¬¦ä¸²æ¨¡æ¿è§£ææˆæŠ½è±¡è¯­æ³•æ ‘`AST`åï¼Œå¯å¯¹å…¶è¿›è¡Œå„ç§æ“ä½œå¤„ç†ï¼Œå¤„ç†å®Œåç”¨å¤„ç†åçš„`AST`æ¥ç”Ÿæˆ`render`å‡½æ•°ã€‚å…·ä½“æµç¨‹åˆ†ä¸ºä¸‰å¤§é˜¶æ®µï¼š

     1. æ¨¡æ¿è§£æé˜¶æ®µï¼šå°†ä¸€å †æ¨¡æ¿å­—ç¬¦ä¸²ç”¨æ­£åˆ™ç­‰æ–¹å¼è§£ææˆæŠ½è±¡è¯­æ³•æ ‘`AST`ï¼›
     2. ä¼˜åŒ–é˜¶æ®µï¼šéå†`AST`ï¼Œæ‰¾åˆ°å…¶ä¸­çš„é™æ€èŠ‚ç‚¹ï¼Œå¹¶æ‰“ä¸Šæ ‡è®°ï¼›
     3. ä»£ç ç”Ÿæˆé˜¶æ®µï¼šå°†`AST`è½¬æ¢æˆæ¸²æŸ“å‡½æ•°

     è¿™ä¸‰ä¸ªé˜¶æ®µåœ¨æºç ä¸­åˆ†åˆ«å¯¹åº”ä¸‰ä¸ªæ¨¡å—ï¼Œå¯¹åº”æºç è·¯å¾„ä¸ºï¼š

     1. æ¨¡æ¿è§£æé˜¶æ®µâ€”â€”è§£æå™¨â€”â€”æºç è·¯å¾„ï¼š`src/compiler/parser/index.js`;

     2. ä¼˜åŒ–é˜¶æ®µâ€”â€”ä¼˜åŒ–å™¨â€”â€”æºç è·¯å¾„ï¼š`src/compiler/optimizer.js`;

     3. ä»£ç ç”Ÿæˆé˜¶æ®µâ€”â€”ä»£ç ç”Ÿæˆå™¨â€”â€”æºç è·¯å¾„ï¼š`src/compiler/codegen/index.js`;

        ```js
        // æºç ä½ç½®: /src/complier/index.js
        export const createCompiler = createCompilerCreator(function baseCompile (
          template: string,
          options: CompilerOptions
        ): CompiledResult {
          // æ¨¡æ¿è§£æé˜¶æ®µï¼šç”¨æ­£åˆ™ç­‰æ–¹å¼è§£æ template æ¨¡æ¿ä¸­çš„æŒ‡ä»¤ã€classã€styleç­‰æ•°æ®ï¼Œå½¢æˆAST
          const ast = parse(template.trim(), options)
          if (options.optimize !== false) {
            // ä¼˜åŒ–é˜¶æ®µï¼šéå†ASTï¼Œæ‰¾å‡ºå…¶ä¸­çš„é™æ€èŠ‚ç‚¹ï¼Œå¹¶æ‰“ä¸Šæ ‡è®°ï¼›
            optimize(ast, options)
          }
          // ä»£ç ç”Ÿæˆé˜¶æ®µï¼šå°†ASTè½¬æ¢æˆæ¸²æŸ“å‡½æ•°ï¼›
          const code = generate(ast, options)
          return {
            ast,
            render: code.render,
            staticRenderFns: code.staticRenderFns
          }
        })
        ```

        å¯ä»¥çœ‹åˆ°`baseCompole`ä»£ç éå¸¸çš„ç®€çŸ­ä¸»è¦æ ¸å¿ƒä»£ç 

        + **const ast =parse(template.trim(), options)** ï¼š`parse`ä¼šç”¨æ­£åˆ™ç­‰æ–¹å¼è§£æ  `template`æ¨¡æ¿ä¸­çš„æŒ‡ä»¤ã€`class`ã€`style`ç­‰æ•°æ®ï¼Œå½¢æˆ`AST`;
        + **optimize(ast, options)**ï¼š`optimize`çš„ä¸»è¦ä½œç”¨æ˜¯æ ‡è®°é™æ€èŠ‚ç‚¹ï¼Œè¿™æ˜¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€å¤„ä¼˜åŒ–ï¼ŒæŒ¡åœ¨è¿›è¡Œ`patch`çš„è¿‡ç¨‹ä¸­ï¼Œ`DOM-Diff`ç®—æ³•ä¼šç›´æ¥è·³è¿‡é™æ€èŠ‚ç‚¹ï¼Œä»è€Œå‡å°‘äº†æ¯”è¾ƒè¿‡ç¨‹ï¼Œä¼˜åŒ–äº†`patch`çš„æ€§èƒ½ï¼›
        + **const code =generate(ast, options)**ï¼šå°† `AST` è½¬åŒ–æˆ `render`å‡½æ•°å­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼Œå¾—åˆ°ç»“æœæ˜¯ `render`å‡½æ•° çš„å­—ç¬¦ä¸²ä»¥åŠ `staticRenderFns` å­—ç¬¦ä¸²ï¼›

        æœ€ç»ˆ`baseCompile`çš„è¿”å›å€¼ï¼š

        ```js
        {
         	ast: ast,
         	render: code.render,
         	staticRenderFns: code.staticRenderFns
         }
        ```

        æœ€ç»ˆè¿”å›äº†æŠ½è±¡è¯­æ³•æ ‘`AST`

  

+ nextTickå®ç°åŸç†

+ keep-aliveå®ç°åŸç†

https://vue-js.com/learn-vue/reactive/object.html#_6-%E6%80%BB%E7%BB%93

